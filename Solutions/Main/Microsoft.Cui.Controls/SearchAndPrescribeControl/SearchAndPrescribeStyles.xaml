<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:Microsoft.Cui.Controls"
    xmlns:system="clr-namespace:System;assembly=mscorlib"
    xmlns:toolkit_primitives="clr-namespace:System.Windows.Controls.Primitives;assembly=System.Windows.Controls">

    <!-- COMMON STYLES -->
    <!-- General Brush Resources -->
    <SolidColorBrush x:Key="Control_Background_Brush" Color="#FFFFFFFF" local:SolidColorBrushHighContrastSetter.Color="#FF000000" />
    <SolidColorBrush x:Key="Control_Foreground_Brush" Color="#FF000000" local:SolidColorBrushHighContrastSetter.Color="#FFE8E8E8" />
    <SolidColorBrush x:Key="Control_BorderBrush_Brush" Color="#FF9A9A9A" local:SolidColorBrushHighContrastSetter.Color="#FFA5A5A5" />
    <SolidColorBrush x:Key="Control_FocusBorderBrush_Brush" Color="#FF000000" local:SolidColorBrushHighContrastSetter.Color="#FFE8E8E8" />
    <SolidColorBrush x:Key="FieldLabel_Foreground_Brush" Color="#ff508dc2" local:SolidColorBrushHighContrastSetter.Color="#FF00FFF0" />
    <SolidColorBrush x:Key="GroupLabel_Foreground_Brush" Color="#FF595959"  local:SolidColorBrushHighContrastSetter.Color="#FFDDDDDD" />

    <!-- Toolbar Brush Resources -->
    <LinearGradientBrush x:Key="Toolbar_Background_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FFB0CBDA" Offset="0"/>
        <GradientStop Color="#FF005788" Offset="1"/>
        <GradientStop Color="#FF075B8B" Offset="0.634"/>
        <GradientStop Color="#FE5992B1" Offset="0.323"/>
        <GradientStop Color="#FE76A5BE" Offset="0.185"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FF3F3F3F 0</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>


    <!-- Toolbar Button Brush Resources -->
    <SolidColorBrush x:Key="ToolbarButton_Foreground_Brush" Color="White" local:SolidColorBrushHighContrastSetter.Color="#FFE8E8E8" />

    <SolidColorBrush x:Key="ToolbarButton_BorderBrush_Brush" Color="#66FFFFFF" />
    <LinearGradientBrush x:Key="ToolbarButton_MouseOverBackground_Brush" EndPoint="0.5,0" StartPoint="0.5,0.791">
        <GradientStop Color="#00DADADA" Offset="0.004"/>
        <GradientStop Color="#99FFFFFF" Offset="1"/>
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="ToolbarButton_PressedBackground_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#33616161"/>
        <GradientStop Color="#99616161" Offset="1"/>
    </LinearGradientBrush>


    <!-- ListBox / Item Resources -->
    <SolidColorBrush x:Key="Searchbox_Background_Brush" Color="White"/>
    <LinearGradientBrush x:Key="Searchbox_BorderBrush_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FF7C7C7C" Offset="0"/>
        <GradientStop Color="#FFD7D7D7" Offset="1"/>
    </LinearGradientBrush>


    <LinearGradientBrush x:Key="ItemsHeader_Background_Brush" EndPoint="0.5,0" StartPoint="0.5,1">
        <GradientStop Offset="0" Color="#FFEEEEEE" />
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FF616161 0,#FFE8E8E8 1</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ItemsHeader_Foreground_Brush" Color="#FF005788" local:SolidColorBrushHighContrastSetter.Color="#FF000000"/>
    <SolidColorBrush x:Key="ItemsRow_Background_Brush" Color="#FFFFFFFF" local:SolidColorBrushHighContrastSetter.Color="#FF000000"/>
    <SolidColorBrush x:Key="ItemsAlternateRow_Background_Brush" Color="#FFEEEEEE" local:SolidColorBrushHighContrastSetter.Color="#FF222222"/>

    <!-- ListBox Item Resources -->
    <SolidColorBrush x:Key="ItemMouseOver_BorderBrush_Brush" Color="#FFCAECFC" local:SolidColorBrushHighContrastSetter.Color="#FFFFE050" />
    <LinearGradientBrush x:Key="ItemMouseOver_Background_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FFF9FDFF"/>
        <GradientStop Color="#FFCAECFC" Offset="1"/>
        <GradientStop Color="#FFC5EDFF" Offset="0.75"/>
        <GradientStop Color="#FFD3EFFC" Offset="0.7"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FF079D07 0,#FF006100 1,#FF008C00 0.754,#FF039203 0.7</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ItemFocused_BorderBrush_Brush" Color="#FFB3DCF0" local:SolidColorBrushHighContrastSetter.Color="#FFFFEE9F"/>
    <LinearGradientBrush x:Key="ItemFocused_Background_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FFF9FDFF"/>
        <GradientStop Color="#FFB3DCF0" Offset="1"/>
        <GradientStop Color="#FFACDBF0" Offset="0.75"/>
        <GradientStop Color="#FFBBE0F2" Offset="0.7"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FF079D07 0,#FF006100 1,#FF008C00 0.754,#FF039203 0.7</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ItemSelected_BorderBrush_Brush" Color="#FFF2A71E" local:SolidColorBrushHighContrastSetter.Color="#FFC5A200"/>
    <LinearGradientBrush x:Key="ItemSelected_Background_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FFFFEDCB" Offset="0"/>
        <GradientStop Color="#FFFFB122" Offset="1"/>
        <GradientStop Color="#FFFFBF4A" Offset="0.75"/>
        <GradientStop Color="#FFFFBF4A" Offset="0.7"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FFAB2BAB 0,#FF630063 1,#FF800080 0.754,#FF880588 0.7</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="MouseOverItemSelected_BorderBrush_Brush" Color="#FFE49E1D" local:SolidColorBrushHighContrastSetter.Color="#FFC5A200"/>
    <LinearGradientBrush x:Key="MouseOverItemSelected_Background_Brush" EndPoint="0.5,1" StartPoint="0.5,0">
        <GradientStop Color="#FFFFE1A9" Offset="0.004"/>
        <GradientStop Color="#FFFFAD16" Offset="1"/>
        <GradientStop Color="#FFFFBF4A" Offset="0.75"/>
        <GradientStop Color="#FFFFBF4A" Offset="0.7"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FFAB2BAB 0,#FF630063 1,#FF800080 0.754,#FF880588 0.7</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush Color="#FFFFA500" x:Key="OptionalFieldContainerPlusIcon_Stroke_Brush" local:SolidColorBrushHighContrastSetter.Color="#FF00FFF0" />

    <LinearGradientBrush EndPoint="0.60699999332428,0.0219999998807907" StartPoint="0.11599999666214,0.930999994277954" x:Key="MagnifierGlassTop_Stroke_Brush">
        <GradientStop Color="#FF0070AF"/>
        <GradientStop Color="#FF3F95C5" Offset="0.996"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FFFFFFFF 0,#FFE4E4E4 1</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <LinearGradientBrush EndPoint="0.607,0.022" StartPoint="0.116,0.931" x:Key="MagnifierGlassBottom_Stroke_Brush">
        <GradientStop Color="#FF0070AF"/>
        <GradientStop Color="#FFA6D0E8" Offset="0.996"/>
        <local:LinearGradientBrushHighContrastSetter.GradientStops>
            <system:String>#FFFFFFFF 0,#FFE0E0E0 1</system:String>
        </local:LinearGradientBrushHighContrastSetter.GradientStops>
    </LinearGradientBrush>

    <!-- CONTROLS STYLES -->
    <Style TargetType="Control" x:Key="BaseControlStyle">
        <Setter Property="BorderThickness" Value="1,1,1,1" />
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
    </Style>

    <!-- Button Styles-->
    <Style x:Key="BasicButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseControlStyle}">
        <Setter Property="HorizontalContentAlignment" Value="Center"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.X)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.Y)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ButtonBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.4"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Border x:Name="ButtonBorder" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                            <Grid>
                                <Rectangle x:Name="MouseOverBorder" Opacity="0" Fill="{StaticResource ItemMouseOver_Background_Brush}" />
                                <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="1" Opacity="0" Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
										Margin="{TemplateBinding Padding}">
                                    <ContentPresenter.RenderTransform>
                                        <TranslateTransform x:Name="ContentPresenterTranslateTransform" />
                                    </ContentPresenter.RenderTransform>
                                </ContentPresenter>
                                <Border x:Name="PressedBorder" Opacity="0">
                                    <Grid>
                                        <Rectangle VerticalAlignment="Top" Height="3">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                    <GradientStop Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                        <Rectangle HorizontalAlignment="Left" Width="3">
                                            <Rectangle.Fill>
                                                <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                    <GradientStop Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="ScrollViewerStyle" TargetType="ScrollViewer"  BasedOn="{StaticResource BaseControlStyle}">
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="VerticalContentAlignment" Value="Top"/>
        <Setter Property="VerticalScrollBarVisibility" Value="Visible"/>
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ScrollViewer">
                    <Grid>
                        <Grid.Resources>
                            <Style x:Key="ScrollBarStyle" BasedOn="{StaticResource BaseControlStyle}" TargetType="ScrollBar">
                                <Setter Property="MinWidth" Value="18"/>
                                <Setter Property="MinHeight" Value="18"/>
                                <Setter Property="IsTabStop" Value="False"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ScrollBar">
                                            <Grid x:Name="Root">
                                                <Grid.Resources>
                                                    <ControlTemplate x:Key="RepeatButtonTemplate" TargetType="RepeatButton">
                                                        <Grid x:Name="Root">
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal"/>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="Background" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="Background" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.X)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledElement" Storyboard.TargetProperty="Opacity">
                                                                                <SplineDoubleKeyFrame KeyTime="0:0:0" Value=".7"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Rectangle x:Name="Background" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1" Opacity="0"/>
                                                            <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ItemMouseOver_Background_Brush}" Margin="1" Opacity="0"/>
                                                            <ContentPresenter x:Name="contentPresenter" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" RenderTransformOrigin="0.5,0.5" >
                                                                <ContentPresenter.RenderTransform>
                                                                    <TransformGroup>
                                                                        <ScaleTransform/>
                                                                        <SkewTransform/>
                                                                        <RotateTransform/>
                                                                        <TranslateTransform/>
                                                                    </TransformGroup>
                                                                </ContentPresenter.RenderTransform>
                                                            </ContentPresenter>
                                                            <Border x:Name="PressedBorder" Margin="1" Opacity="0">
                                                                <Grid>
                                                                    <Rectangle Height="3" VerticalAlignment="Top">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                                                <GradientStop Color="#44000000" Offset="0"/>
                                                                                <GradientStop Offset="1"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                    <Rectangle HorizontalAlignment="Left" Width="3">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                                                <GradientStop Color="#44000000" Offset="0"/>
                                                                                <GradientStop Offset="1"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                </Grid>
                                                            </Border>
                                                            <Rectangle x:Name="DisabledElement" Fill="#FFFFFFFF" Opacity="0"/>
                                                        </Grid>
                                                    </ControlTemplate>
                                                    <ControlTemplate x:Key="FadedRepeatButtonTemplate" TargetType="RepeatButton">
                                                        <Grid x:Name="Root">
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal"/>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="Background" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="Background" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.X)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledElement" Storyboard.TargetProperty="Opacity">
                                                                                <SplineDoubleKeyFrame KeyTime="0:0:0" Value=".7"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Rectangle x:Name="Background" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1" Opacity="0"/>
                                                            <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ItemMouseOver_Background_Brush}" Margin="1" Opacity="0"/>
                                                            <ContentPresenter x:Name="contentPresenter" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" RenderTransformOrigin="0.5,0.5" >
                                                                <ContentPresenter.RenderTransform>
                                                                    <TransformGroup>
                                                                        <ScaleTransform/>
                                                                        <SkewTransform/>
                                                                        <RotateTransform/>
                                                                        <TranslateTransform/>
                                                                    </TransformGroup>
                                                                </ContentPresenter.RenderTransform>
                                                            </ContentPresenter>
                                                            <Border x:Name="PressedBorder" Margin="1" Opacity="0">
                                                                <Grid>
                                                                    <Rectangle Height="3" VerticalAlignment="Top">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                                                <GradientStop Color="#44000000" Offset="0"/>
                                                                                <GradientStop Offset="1"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                    <Rectangle HorizontalAlignment="Left" Width="3">
                                                                        <Rectangle.Fill>
                                                                            <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                                                <GradientStop Color="#44000000" Offset="0"/>
                                                                                <GradientStop Offset="1"/>
                                                                            </LinearGradientBrush>
                                                                        </Rectangle.Fill>
                                                                    </Rectangle>
                                                                </Grid>
                                                            </Border>
                                                            <Rectangle x:Name="DisabledElement" Fill="#FFFFFFFF" Opacity="0"/>
                                                        </Grid>
                                                    </ControlTemplate>
                                                    <ControlTemplate x:Key="VerticalThumbTemplate" TargetType="Thumb">
                                                        <Grid>
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal"/>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="canvas" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.X)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="canvas" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ThumbVisual" Storyboard.TargetProperty="Opacity">
                                                                                <SplineDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Grid x:Name="ThumbVisual" Margin="1,1,1,1">
                                                                <Rectangle x:Name="Background" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1"/>
                                                                <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ItemMouseOver_Background_Brush}" Margin="1" Opacity="0"/>
                                                                <Canvas x:Name="canvas" Height="5" Width="8" VerticalAlignment="Center" HorizontalAlignment="Center" RenderTransformOrigin="0.5,0.5">
                                                                    <Canvas.RenderTransform>
                                                                        <TransformGroup>
                                                                            <ScaleTransform/>
                                                                            <SkewTransform/>
                                                                            <RotateTransform/>
                                                                            <TranslateTransform/>
                                                                        </TransformGroup>
                                                                    </Canvas.RenderTransform>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="1" Width="8" Data="M0,0 L1,0" StrokeStartLineCap="Square" StrokeEndLineCap="Square"/>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="1" Width="8" Data="M0,0 L1,0" StrokeEndLineCap="Square" StrokeStartLineCap="Square" Canvas.Top="2"/>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="1" Width="8" Data="M0,0 L1,0" StrokeEndLineCap="Square" StrokeStartLineCap="Square" Canvas.Top="4"/>
                                                                </Canvas>
                                                                <Border x:Name="PressedBorder" Margin="1" Opacity="0">
                                                                    <Grid>
                                                                        <Rectangle Height="3" VerticalAlignment="Top">
                                                                            <Rectangle.Fill>
                                                                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                                                    <GradientStop Offset="1"/>
                                                                                </LinearGradientBrush>
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                        <Rectangle HorizontalAlignment="Left" Width="3">
                                                                            <Rectangle.Fill>
                                                                                <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                                                    <GradientStop Offset="1"/>
                                                                                </LinearGradientBrush>
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                    </Grid>
                                                                </Border>
                                                            </Grid>
                                                        </Grid>
                                                    </ControlTemplate>

                                                    <ControlTemplate x:Key="HorizontalThumbTemplate" TargetType="Thumb">
                                                        <Grid>
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal"/>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="canvas" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.X)">
                                                                                <EasingDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ThumbVisual" Storyboard.TargetProperty="Opacity">
                                                                                <SplineDoubleKeyFrame KeyTime="0:0:0" Value="0"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Grid x:Name="ThumbVisual" Margin="1,1,1,1">
                                                                <Rectangle x:Name="Background" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="1"/>
                                                                <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ItemMouseOver_Background_Brush}" Margin="1" Opacity="0"/>
                                                                <Canvas x:Name="canvas" Height="8" HorizontalAlignment="Center" VerticalAlignment="Center" Width="5" RenderTransformOrigin="0.5,0.5">
                                                                    <Canvas.RenderTransform>
                                                                        <TransformGroup>
                                                                            <ScaleTransform/>
                                                                            <SkewTransform/>
                                                                            <RotateTransform/>
                                                                            <TranslateTransform/>
                                                                        </TransformGroup>
                                                                    </Canvas.RenderTransform>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="8" Width="1" Data="M0,0 L0,1" StrokeStartLineCap="Square" StrokeEndLineCap="Square" Canvas.Top="0"/>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="8" Width="1" Data="M0,0 L0,1" StrokeEndLineCap="Square" StrokeStartLineCap="Square" Canvas.Top="0" Canvas.Left="2"/>
                                                                    <Path Stretch="Fill" Stroke="{TemplateBinding BorderBrush}" Height="8" Width="1" Data="M0,0 L0,1" StrokeEndLineCap="Square" StrokeStartLineCap="Square" Canvas.Top="0" Canvas.Left="4"/>
                                                                </Canvas>
                                                                <Border x:Name="PressedBorder" Margin="1" Opacity="0">
                                                                    <Grid>
                                                                        <Rectangle Height="3" VerticalAlignment="Top">
                                                                            <Rectangle.Fill>
                                                                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                                                    <GradientStop Offset="1"/>
                                                                                </LinearGradientBrush>
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                        <Rectangle HorizontalAlignment="Left" Width="3">
                                                                            <Rectangle.Fill>
                                                                                <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                                                    <GradientStop Color="#44000000" Offset="0"/>
                                                                                    <GradientStop Offset="1"/>
                                                                                </LinearGradientBrush>
                                                                            </Rectangle.Fill>
                                                                        </Rectangle>
                                                                    </Grid>
                                                                </Border>
                                                            </Grid>
                                                        </Grid>
                                                    </ControlTemplate>

                                                </Grid.Resources>
                                                <VisualStateManager.VisualStateGroups>
                                                    <VisualStateGroup x:Name="CommonStates">
                                                        <VisualState x:Name="Normal"/>
                                                        <VisualState x:Name="MouseOver"/>
                                                        <VisualState x:Name="Disabled">
                                                            <Storyboard>
                                                                <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Root" Storyboard.TargetProperty="Opacity">
                                                                    <SplineDoubleKeyFrame KeyTime="0" Value="0.5"/>
                                                                </DoubleAnimationUsingKeyFrames>
                                                            </Storyboard>
                                                        </VisualState>
                                                    </VisualStateGroup>
                                                </VisualStateManager.VisualStateGroups>
                                                <Grid x:Name="HorizontalRoot">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <Rectangle Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" Grid.ColumnSpan="5"/>
                                                    <RepeatButton x:Name="HorizontalSmallDecrease" Margin="2,2,1,2" Style="{StaticResource BaseControlStyle}" Width="16" IsTabStop="False" Template="{StaticResource RepeatButtonTemplate}" Grid.Column="0" Interval="50">
                                                        <Path Fill="{TemplateBinding Foreground}" Stretch="Uniform" Height="8" Width="4" Data="F1 M 110.692,342.252L 110.692,352.682L 104.594,347.467L 110.692,342.252 Z "/>
                                                    </RepeatButton>
                                                    <RepeatButton x:Name="HorizontalLargeDecrease" Style="{StaticResource BaseControlStyle}" Width="0" IsTabStop="False" Template="{StaticResource FadedRepeatButtonTemplate}" Grid.Column="1" Interval="50"/>
                                                    <Thumb x:Name="HorizontalThumb" Margin="0,1" MinWidth="18" Style="{StaticResource BaseControlStyle}" Width="18" Background="{TemplateBinding Background}" Template="{StaticResource HorizontalThumbTemplate}" Grid.Column="2"/>
                                                    <RepeatButton x:Name="HorizontalLargeIncrease" Style="{StaticResource BaseControlStyle}" IsTabStop="False" Template="{StaticResource FadedRepeatButtonTemplate}" Grid.Column="3" Interval="50"/>
                                                    <RepeatButton x:Name="HorizontalSmallIncrease" Margin="1,2,2,2" Style="{StaticResource BaseControlStyle}" Width="16" IsTabStop="False" Template="{StaticResource RepeatButtonTemplate}" Grid.Column="4" Interval="50">
                                                        <Path Fill="{TemplateBinding Foreground}" Stretch="Uniform" Height="8" Width="4" Data="F1 M 511.047,352.682L 511.047,342.252L 517.145,347.467L 511.047,352.682 Z "/>
                                                    </RepeatButton>
                                                </Grid>
                                                <Grid x:Name="VerticalRoot" Visibility="Collapsed">
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="*"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>
                                                    <Rectangle Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" Margin="0" Grid.RowSpan="5"/>
                                                    <RepeatButton x:Name="VerticalSmallDecrease" Height="16" Margin="2,2,2,1" Style="{StaticResource BaseControlStyle}" IsTabStop="False" Template="{StaticResource RepeatButtonTemplate}" Grid.Row="0" Interval="50">
                                                        <Path Fill="{TemplateBinding Foreground}" Stretch="Uniform" Height="4" Width="8" Data="F1 M 541.537,173.589L 531.107,173.589L 536.322,167.49L 541.537,173.589 Z "/>
                                                    </RepeatButton>
                                                    <RepeatButton x:Name="VerticalLargeDecrease" Height="0" Style="{StaticResource BaseControlStyle}" IsTabStop="False" Template="{StaticResource FadedRepeatButtonTemplate}" Grid.Row="1" Interval="50"/>
                                                    <Thumb x:Name="VerticalThumb" Height="18" Margin="1,0" MinHeight="18" Style="{StaticResource BaseControlStyle}" Template="{StaticResource VerticalThumbTemplate}" Grid.Row="2"/>
                                                    <RepeatButton x:Name="VerticalLargeIncrease" Style="{StaticResource BaseControlStyle}" IsTabStop="False" Template="{StaticResource FadedRepeatButtonTemplate}" Grid.Row="3" Interval="50"/>
                                                    <RepeatButton x:Name="VerticalSmallIncrease" Height="16" Margin="2,1,2,2" Style="{StaticResource BaseControlStyle}" IsTabStop="False" Template="{StaticResource RepeatButtonTemplate}" Grid.Row="4" Interval="50">
                                                        <Path Fill="{TemplateBinding Foreground}" Stretch="Uniform" Height="4" Width="8" Data="F1 M 531.107,321.943L 541.537,321.943L 536.322,328.042L 531.107,321.943 Z "/>
                                                    </RepeatButton>
                                                </Grid>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Grid.Resources>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
										Grid.RowSpan="2" Grid.ColumnSpan="2" />
                        <ScrollContentPresenter x:Name="ScrollContentPresenter" Cursor="{TemplateBinding Cursor}" Margin="{TemplateBinding Padding}" ContentTemplate="{TemplateBinding ContentTemplate}"/>
                        <Rectangle Fill="White" Grid.Column="1" Grid.Row="1" Opacity="0"/>
                        <ScrollBar x:Name="VerticalScrollBar" Style="{StaticResource ScrollBarStyle}" Width="17" Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}" IsTabStop="False" Grid.Column="1" Grid.Row="0" Maximum="{TemplateBinding ScrollableHeight}" Minimum="0" Value="{TemplateBinding VerticalOffset}" Orientation="Vertical" ViewportSize="{TemplateBinding ViewportHeight}"/>
                        <ScrollBar x:Name="HorizontalScrollBar" Height="17" Style="{StaticResource ScrollBarStyle}" Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}" IsTabStop="False" Grid.Column="0" Grid.Row="1" Maximum="{TemplateBinding ScrollableWidth}" Minimum="0" Value="{TemplateBinding HorizontalOffset}" Orientation="Horizontal" ViewportSize="{TemplateBinding ViewportWidth}"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <Style x:Key="ToolbarButton_Style" TargetType="Button">
        <Setter Property="Padding" Value="8,4,8,4" />
        <Setter Property="Foreground" Value="White" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Button">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.X)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.Y)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Border>
                            <Grid>
                                <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ToolbarButton_MouseOverBackground_Brush}" Stroke="{StaticResource ToolbarButton_BorderBrush_Brush}" StrokeThickness="1" Opacity="0"/>
                                <Rectangle x:Name="PressedBorder" Fill="{StaticResource ToolbarButton_PressedBackground_Brush}" Stroke="{StaticResource ToolbarButton_BorderBrush_Brush}" StrokeThickness="1" Opacity="0"/>
                                <Rectangle x:Name="FocusBorder" Stroke="White" StrokeDashArray="2 2" Margin="1" Opacity="0"/>
                                <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
										Margin="{TemplateBinding Padding}" x:Name="ContentPresenter">
                                    <ContentPresenter.RenderTransform>
                                        <TranslateTransform x:Name="ContentPresenterTranslateTransform" />
                                    </ContentPresenter.RenderTransform>
                                </ContentPresenter>
                            </Grid>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style x:Key="ToolbarButton_ViewToggle_Style" TargetType="CheckBox">
        <Setter Property="Padding" Value="8,4,8,4" />
        <Setter Property="Foreground" Value="White" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="CheckBox">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Pressed">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.X)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.Y)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentStackPanel" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0.3"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="CheckStates">
                                <VisualState x:Name="Checked">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Arrow" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(RotateTransform.Angle)">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="180"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unchecked"/>
                                <VisualState x:Name="Indeterminate"/>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Border>
                            <Grid>
                                <Rectangle x:Name="MouseOverBorder" Fill="{StaticResource ToolbarButton_MouseOverBackground_Brush}" Stroke="{StaticResource ToolbarButton_BorderBrush_Brush}" StrokeThickness="1" Opacity="0"/>
                                <Rectangle x:Name="PressedBorder" Fill="{StaticResource ToolbarButton_PressedBackground_Brush}" Stroke="{StaticResource ToolbarButton_BorderBrush_Brush}" StrokeThickness="1" Opacity="0"/>
                                <Rectangle x:Name="FocusBorder" Stroke="White" StrokeDashArray="2 2" Margin="1" Opacity="0"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
										Margin="{TemplateBinding Padding}" x:Name="ContentStackPanel">
                                    <StackPanel.RenderTransform>
                                        <TranslateTransform x:Name="ContentPresenterTranslateTransform" />
                                    </StackPanel.RenderTransform>
                                    <Path Fill="{TemplateBinding Foreground}" Stretch="Fill" Height="6" Margin="0,0,5,0" Width="9" Data="M225,225 L250,175 L200,175 z"
                                          RenderTransformOrigin="0.5,0.5" x:Name="Arrow">
                                        <Path.RenderTransform>
                                            <TransformGroup>
                                                <RotateTransform Angle="0" />
                                            </TransformGroup>
                                        </Path.RenderTransform>
                                    </Path>
                                    <ContentPresenter x:Name="ContentPresenter"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <!-- END COMMON STYLES -->

    <!-- SplitListBoxItem Style -->
    <Style TargetType="local:SplitListBoxItem">
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="HeaderTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Border Background="{StaticResource ItemsHeader_Background_Brush}">
                            <TextBlock Text="{Binding}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Left" Margin="4,4,4,4"
                                       Foreground="{StaticResource ItemsHeader_Foreground_Brush}"/>
                        </Border>

                        <Rectangle Height="3" Margin="0,0,0,-3" Opacity="0.5" VerticalAlignment="Bottom">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#55000000" Offset="0" />
                                    <GradientStop Color="#00000000" Offset="1" />
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:SplitListBoxItem">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0:0:0.15" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverSelectedBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value=".55"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ConfirmedSelectedItemStates">
                                <VisualState x:Name="UnconfirmedSelectedItem" />
                                <VisualState x:Name="ConfirmedSelectedItem">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SelectedValueBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="MouseOverSelectedBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="SelectionStates">
                                <VisualState x:Name="Unselected" />
                                <VisualState x:Name="Selected">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SelectedBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused"/>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>


                        <Border BorderThickness="{TemplateBinding SplitBorderThickness}"
                                    BorderBrush="{TemplateBinding SplitBorderBrush}"
                                Grid.Row="1" >
                            <Border Background="{TemplateBinding Background}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    x:Name="ContentBorder">
                                <Grid>
                                    <Rectangle x:Name="SelectedBorder" StrokeThickness="1" IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource ItemFocused_BorderBrush_Brush}"
                                               Fill="{StaticResource ItemFocused_Background_Brush}" />

                                    <Rectangle x:Name="MouseOverBorder" StrokeThickness="1"  IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource ItemMouseOver_BorderBrush_Brush}"
                                               Fill="{StaticResource ItemMouseOver_Background_Brush}" />

                                    <Border x:Name="SelectedValueBorder" BorderThickness="1,1,1,1" Margin="0,0,0,0" IsHitTestVisible="False" Opacity="0"
                                             BorderBrush="{StaticResource ItemSelected_BorderBrush_Brush}"
                                               Background="{StaticResource ItemSelected_Background_Brush}" />

                                    <Rectangle Visibility="Collapsed" x:Name="MouseOverSelectedBorder" StrokeThickness="1" IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource MouseOverItemSelected_BorderBrush_Brush}"
                                               Fill="{StaticResource MouseOverItemSelected_Background_Brush}" />

                                    <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="1" Opacity="0" IsHitTestVisible="False" 
                                               Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />
                                    <Grid Margin="4,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter x:Name="contentPresenter" Opacity="1" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Margin="{TemplateBinding Padding}" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"
                                                      >
                                        </ContentPresenter>

                                        <Border Opacity="0.5"
                                                Grid.Column="1"
                                                VerticalAlignment="Top" HorizontalAlignment="Right">
                                            <TextBlock
                                                   Margin="{TemplateBinding Padding}"
                                                   Opacity="{TemplateBinding ShortcutKeyTextOpacity}"
                                                   Text="{TemplateBinding ShortcutKeyText}"
                                                   RenderTransformOrigin="1,0"
                                                   >
                                            <TextBlock.RenderTransform>
                                                <ScaleTransform ScaleX="0.75" ScaleY="0.75" />
                                            </TextBlock.RenderTransform>
                                            </TextBlock>
                                        </Border>
                                    </Grid>

                                </Grid>
                            </Border>
                        </Border>

                        <ContentControl IsTabStop="False"
                                        Content="{TemplateBinding Header}"
                                        ContentTemplate="{TemplateBinding HeaderTemplate}"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        IsHitTestVisible="False"
                                        Visibility="{TemplateBinding ComputedHeaderVisibility}"
                                        />

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- SplitComboBoxItem Style -->
    <Style TargetType="local:SplitComboBoxItem">
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Center"/>
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="HeaderTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Border Background="{StaticResource ItemsHeader_Background_Brush}">
                            <TextBlock Text="{Binding}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Left" Margin="4,4,4,4"
                                       Foreground="{StaticResource ItemsHeader_Foreground_Brush}"/>
                        </Border>

                        <Rectangle Height="3" Margin="0,0,0,-3" Opacity="0.5" VerticalAlignment="Bottom">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#55000000" Offset="0" />
                                    <GradientStop Color="#00000000" Offset="1" />
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:SplitComboBoxItem">
                    <Grid>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0:0:0.15" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverSelectedBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="contentPresenter" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value=".55"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ConfirmedSelectedItemStates">
                                <VisualState x:Name="UnconfirmedSelectedItem" />
                                <VisualState x:Name="ConfirmedSelectedItem">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SelectedValueBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="MouseOverSelectedBorder" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="SelectionStates">
                                <VisualState x:Name="Unselected" />
                                <VisualState x:Name="Selected">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="SelectedBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused"/>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>


                        <Border BorderThickness="{TemplateBinding SplitBorderThickness}"
                                    BorderBrush="{TemplateBinding SplitBorderBrush}"
                                Grid.Row="1" >
                            <Border Background="{TemplateBinding Background}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    x:Name="ContentBorder">
                                <Grid>
                                    <Rectangle x:Name="SelectedBorder" StrokeThickness="1" IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource ItemFocused_BorderBrush_Brush}"
                                               Fill="{StaticResource ItemFocused_Background_Brush}" />

                                    <Rectangle x:Name="MouseOverBorder" StrokeThickness="1"  IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource ItemMouseOver_BorderBrush_Brush}"
                                               Fill="{StaticResource ItemMouseOver_Background_Brush}" />

                                    <Border x:Name="SelectedValueBorder" BorderThickness="1,1,1,1" Margin="0,0,0,0" IsHitTestVisible="False" Opacity="0"
                                             BorderBrush="{StaticResource ItemSelected_BorderBrush_Brush}"
                                               Background="{StaticResource ItemSelected_Background_Brush}" />

                                    <Rectangle Visibility="Collapsed" x:Name="MouseOverSelectedBorder" StrokeThickness="1" IsHitTestVisible="False" Opacity="0"
                                               Stroke="{StaticResource MouseOverItemSelected_BorderBrush_Brush}"
                                               Fill="{StaticResource MouseOverItemSelected_Background_Brush}" />

                                    <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="1" Opacity="0" IsHitTestVisible="False" 
                                               Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />

                                    <Grid Margin="4,0,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <ContentPresenter x:Name="contentPresenter" Opacity="1" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Margin="{TemplateBinding Padding}" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"
                                                          IsHitTestVisible="False"
                                                      >
                                        </ContentPresenter>
                                        <TextBlock Grid.Column="1"
                                                   VerticalAlignment="Top" HorizontalAlignment="Right"
                                                   Margin="{TemplateBinding Padding}"
                                                   Opacity="0.5"
                                                   Text="{TemplateBinding ShortcutKeyText}"
                                                   RenderTransformOrigin="1,0"
                                                   >
                                            <TextBlock.RenderTransform>
                                                <ScaleTransform ScaleX="0.75" ScaleY="0.75" />
                                            </TextBlock.RenderTransform>
                                        </TextBlock>
                                    </Grid>

                                </Grid>
                            </Border>
                        </Border>

                        <ContentControl IsTabStop="False"
                                        Content="{TemplateBinding Header}"
                                        ContentTemplate="{TemplateBinding HeaderTemplate}"
                                        HorizontalContentAlignment="Stretch"
                                        VerticalContentAlignment="Stretch"
                                        IsHitTestVisible="False"
                                        Visibility="{TemplateBinding ComputedHeaderVisibility}"
                                        />

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- CascadingListBoxGroup Style -->
    <Style TargetType="local:CascadingListBoxGroup">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <local:LinkingWrapPanel/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:CascadingListBoxGroup">
                    <ItemsPresenter />
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- LabeledContentControl Style -->
    <Style TargetType="local:LabeledContentControl">
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="VerticalAlignment" Value="Stretch" />
        <Setter Property="HorizontalAlignment" Value="Stretch" />
        <Setter Property="HorizontalContentAlignment" Value="Left" />
        <Setter Property="VerticalContentAlignment" Value="Top" />
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="LabelTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Text="{Binding}"
                               VerticalAlignment="Top"
                               Foreground="{StaticResource FieldLabel_Foreground_Brush}"
                               />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:LabeledContentControl">
                    <Grid>
                        <Grid.Resources>
                            <local:NullEmptyToVisibilityConverter x:Key="NullEmptyToVisibilityConverter" />
                        </Grid.Resources>
                        <Border Background="{TemplateBinding Background}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Rectangle Fill="Transparent" x:Name="LabelAreaElement" />
                                <ContentControl IsTabStop="False"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            Content="{TemplateBinding Label}"
                                            ContentTemplate="{TemplateBinding LabelTemplate}"
                                                Margin="{TemplateBinding Padding}"
                                                Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=Label}"
                                                IsHitTestVisible="False"
                                            />
                                <ContentPresenter VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                  Grid.Column="1"
                                              />
                            </Grid>

                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- OptionalFieldContainer Style -->
    <Style TargetType="local:OptionalFieldContainer">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="ShowFieldButtonStyle">
            <Setter.Value>
                <Style TargetType="Button">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}"/>
                    <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                    <Setter Property="Padding" Value="6,6,6,6" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="FocusStates">
                                            <VisualState x:Name="Focused">
                                                <Storyboard>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Unfocused"/>
                                        </VisualStateGroup>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal"/>
                                            <VisualState x:Name="MouseOver">
                                                <Storyboard>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PlusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Pressed">
                                                <Storyboard>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.X)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                    <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.Y)">
                                                        <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                    </DoubleAnimationUsingKeyFrames>
                                                    <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="Visibility">
                                                        <DiscreteObjectKeyFrame KeyTime="0">
                                                            <DiscreteObjectKeyFrame.Value>
                                                                <Visibility>Collapsed</Visibility>
                                                            </DiscreteObjectKeyFrame.Value>
                                                        </DiscreteObjectKeyFrame>
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Disabled"/>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                    <Border x:Name="MouseOverBorder" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" Background="Transparent" Opacity="0"/>
                                    <Border x:Name="PressedBorder" Background="Transparent" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" Opacity="0">
                                        <Grid>
                                            <Rectangle VerticalAlignment="Top" Height="3">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                        <GradientStop Color="#44000000" Offset="0"/>
                                                        <GradientStop Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>
                                            <Rectangle HorizontalAlignment="Left" Width="3">
                                                <Rectangle.Fill>
                                                    <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                        <GradientStop Color="#44000000" Offset="0"/>
                                                        <GradientStop Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Rectangle.Fill>
                                            </Rectangle>
                                        </Grid>
                                    </Border>
                                    <StackPanel x:Name="stackPanel" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Margin="{TemplateBinding Padding}" Orientation="Horizontal" RenderTransformOrigin="0.5,0.5">
                                        <StackPanel.RenderTransform>
                                            <TranslateTransform x:Name="ContentTranslateTransform" />
                                        </StackPanel.RenderTransform>
                                        <Grid Width="13" Height="13">
                                            <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" x:Name="PlusBorder"  />
                                            <Path Margin="2" Fill="White" Stretch="Fill" HorizontalAlignment="Center" Width="1" Data="M0,0 L0,1" VerticalAlignment="Center"
                                      Stroke="{StaticResource OptionalFieldContainerPlusIcon_Stroke_Brush}" />
                                            <Path Margin="2" Stretch="Fill" Height="1" VerticalAlignment="Center" Data="M0,0 L1,0" HorizontalAlignment="Center"
                                      Stroke="{StaticResource OptionalFieldContainerPlusIcon_Stroke_Brush}" />
                                        </Grid>
                                        <ContentPresenter Margin="5,2,0,0" VerticalAlignment="Center" />
                                    </StackPanel>
                                    <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="2" Opacity="0" Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:OptionalFieldContainer">
                    <Border BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}"
                            >

                        <Grid>

                            <ContentPresenter x:Name="ContentPresenter" 
                                              Visibility="Collapsed"
                                              />

                            <Button x:Name="ShowFieldButton" 
                                    Content="{TemplateBinding ShowFieldButtonContent}"
                                    ContentTemplate="{TemplateBinding ShowFieldButtonContentTemplate}"
                                    Style="{TemplateBinding ShowFieldButtonStyle}"
                                    />

                        </Grid>

                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- CollapsibleContentControl Style -->
    <Style TargetType="local:CollapsibleContentControl">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:CollapsibleContentControl">
                    <Border BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}"
                            >

                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="ExpandedStates">
                                <VisualState x:Name="Expanded">
                                    <Storyboard>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="1" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="(ScaleTransform.ScaleX)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="1" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="(ScaleTransform.ScaleY)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="1" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Collapsed">
                                    <Storyboard>
                                        <ObjectAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0:0:0.35">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.20" Storyboard.TargetName="ContentPresenter" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.20" Value="0" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="(ScaleTransform.ScaleX)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="0" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="0:0:0.35" Storyboard.TargetName="ContentScale" Storyboard.TargetProperty="(ScaleTransform.ScaleY)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="0" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid VerticalAlignment="Top" HorizontalAlignment="Left">
                            <Canvas x:Name="ContentContainer">
                                <Canvas.Resources>
                                    <Storyboard x:Key="ResizeStoryboard">
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ContentContainer" Storyboard.TargetProperty="Height">
                                            <SplineDoubleKeyFrame KeyTime="00:00:0.35" Value="0" KeySpline="0.841000020503998,0.303999990224838,0.0740000009536743,1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </Canvas.Resources>
                                <ContentPresenter x:Name="ContentPresenter" 
                                              VerticalAlignment="Top" HorizontalAlignment="Left" Opacity="0"
                                              >
                                    <ContentPresenter.RenderTransform>
                                        <ScaleTransform x:Name="ContentScale" />
                                    </ContentPresenter.RenderTransform>
                                </ContentPresenter>
                            </Canvas>
                        </Grid>

                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- SplitListBox Style -->
    <Style TargetType="local:SplitListBox">
        <Setter Property="Padding" Value="0" />
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="RowBackground" Value="{StaticResource ItemsRow_Background_Brush}" />
        <Setter Property="AlternateRowBackground" Value="{StaticResource ItemsAlternateRow_Background_Brush}" />
        <Setter Property="SplitBorderBrush" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Top"/>
        <Setter Property="IsTabStop" Value="False"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="TabNavigation" Value="Once"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemHeaderTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Border Background="{StaticResource ItemsHeader_Background_Brush}">
                            <TextBlock Text="{Binding}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Left" Margin="4,4,4,4"
                                       Foreground="{StaticResource ItemsHeader_Foreground_Brush}"/>
                        </Border>

                        <Rectangle Height="3" Margin="0,0,0,-3" Opacity="0.5" VerticalAlignment="Bottom">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#55000000" Offset="0" />
                                    <GradientStop Color="#00000000" Offset="1" />
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="OtherItemTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Text="{Binding}" />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:SplitListBox">
                    <Grid>
                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" >
                            <ScrollViewer x:Name="ScrollViewer" Background="Transparent" BorderBrush="Transparent" BorderThickness="0" Padding="{TemplateBinding Padding}" TabNavigation="{TemplateBinding TabNavigation}">
                                <ItemsPresenter/>
                            </ScrollViewer>
                        </Border>

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- CascadingListBox Style -->
    <Style TargetType="local:CascadingListBox">
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="RowBackground" Value="{StaticResource ItemsRow_Background_Brush}" />
        <Setter Property="AlternateRowBackground" Value="{StaticResource ItemsAlternateRow_Background_Brush}" />
        <Setter Property="SplitBorderBrush" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="VerticalContentAlignment" Value="Stretch"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="IsTabStop" Value="False"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="TabNavigation" Value="Once"/>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemHeaderTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Border Background="{StaticResource ItemsHeader_Background_Brush}">
                            <TextBlock Text="{Binding}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Left" Margin="4,4,4,4"
                                       Foreground="{StaticResource ItemsHeader_Foreground_Brush}"/>
                        </Border>

                        <Rectangle Height="3" Margin="0,0,0,-3" Opacity="0.5" VerticalAlignment="Bottom">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#55000000" Offset="0" />
                                    <GradientStop Color="#00000000" Offset="1" />
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="OtherItemTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Margin="4,0,0,0" Text="{Binding}" />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="MessageTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Text="{Binding}" Margin="5"
                               FontStyle="Italic"
                               Opacity="0.3"/>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Message" Value="No items to display" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:CascadingListBox">
                    <Grid>
                        <Grid.Resources>
                            <local:NullEmptyToVisibilityConverter x:Key="NullEmptyToVisibilityConverter" />
                        </Grid.Resources>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="ConfirmedSelectedItemStates">
                                <VisualState x:Name="ConfirmedSelectedItemCleared">
                                    <Storyboard />
                                </VisualState>
                                <VisualState x:Name="ConfirmedSelectedItemChanged">
                                    <Storyboard />
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ExpandedStates">
                                <VisualState x:Name="Collapsed">
                                    <Storyboard>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="SelectedItemButton" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="00:00:00.2" Storyboard.TargetName="SelectedItemButton" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0:0:0" Storyboard.TargetName="ScrollViewer" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0:0:0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="ItemsPresenter" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Expanded">
                                    <Storyboard>
                                        <ObjectAnimationUsingKeyFrames Duration="0:0:0.1" Storyboard.TargetName="SelectedItemButton" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0:0:0.1">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Collapsed</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="SelectedItemButton" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                        <ObjectAnimationUsingKeyFrames Duration="0" Storyboard.TargetName="ScrollViewer" Storyboard.TargetProperty="Visibility">
                                            <DiscreteObjectKeyFrame KeyTime="0">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                        <DoubleAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="ItemsPresenter" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ValidationStates">
                                <VisualState x:Name="Valid"/>
                                <VisualState x:Name="InvalidUnfocused" />
                                <VisualState x:Name="InvalidFocused" />
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>


                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="0"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                            <ScrollViewer x:Name="ScrollViewer" Background="{TemplateBinding Background}" BorderBrush="Transparent" BorderThickness="0"
                                          Padding="0"
                                          TabNavigation="{TemplateBinding TabNavigation}" IsTabStop="False"
                                          Visibility="Collapsed"
                                          Style="{StaticResource ScrollViewerStyle}">
                                <ItemsPresenter x:Name="ItemsPresenter" 
                                                MinWidth="{TemplateBinding MinListBoxWidth}"
                                                />
                            </ScrollViewer>
                        </Border>


                        <Border VerticalAlignment="Top" Margin="25,1,18,0" HorizontalAlignment="Right" Visibility="{TemplateBinding LookBehindVisibility}">
                            <Grid>
                                <Button IsTabStop="False" x:Name="LookBehindButton" Style="{StaticResource BasicButtonStyle}"  Padding="3,2,3,2"
                                        >
                                    <StackPanel Margin="3" Orientation="Horizontal">
                                        <Border Height="12" Width="12" BorderThickness="1"
                                                Background="{StaticResource ItemSelected_Background_Brush}"
                                                BorderBrush="{StaticResource ItemSelected_BorderBrush_Brush}" />
                                        <Path Stretch="Fill" Height="6" Margin="5,0,0,0" VerticalAlignment="Center" Width="8" Data="M390,169 L384,175 L396,175 z"
                                              Fill="{StaticResource Control_Foreground_Brush}" />
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Border>

                        <Border VerticalAlignment="Bottom" Margin="25,0,18,1" HorizontalAlignment="Right" Visibility="{TemplateBinding LookAheadVisibility}" >
                            <Grid>
                                <Button IsTabStop="False" x:Name="LookAheadButton" Style="{StaticResource BasicButtonStyle}" Padding="3,2,3,2"
                                        >
                                    <StackPanel Margin="3" Orientation="Horizontal">
                                        <Border Height="12" Width="12" BorderThickness="1"
                                                Background="{StaticResource ItemSelected_Background_Brush}"
                                                BorderBrush="{StaticResource ItemSelected_BorderBrush_Brush}"
                                            />

                                        <Path Stretch="Fill" Height="6" Margin="5,0,0,0" VerticalAlignment="Center" Width="8" Data="M390,180.41667 L384,175 L396,175 z"
                                              Fill="{StaticResource Control_Foreground_Brush}" />
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </Border>

                        <Button x:Name="SelectedItemButton" Content="{TemplateBinding ConfirmedSelectedItem}" ContentTemplate="{TemplateBinding ItemTemplate}"
                                Style="{StaticResource BasicButtonStyle}"
                                Padding="{TemplateBinding Padding}"
                                HorizontalContentAlignment="Left" VerticalAlignment="Top"/>

                        <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                                Visibility="{TemplateBinding MessageVisibility}" Background="{TemplateBinding Background}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}">
                            <ContentControl IsTabStop="False"
                                            Content="{TemplateBinding Message}"
                                            ContentTemplate="{TemplateBinding MessageTemplate}"
                                            Foreground="{TemplateBinding Foreground}"
                                            />
                        </Border>


                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- SplitComboBox Style -->
    <Style TargetType="local:SplitComboBox">
        <Setter Property="Padding" Value="6,6,6,6" />
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="RowBackground" Value="{StaticResource ItemsRow_Background_Brush}" />
        <Setter Property="AlternateRowBackground" Value="{StaticResource ItemsAlternateRow_Background_Brush}" />
        <Setter Property="SplitBorderBrush" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="TabNavigation" Value="Once"/>
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel />
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemHeaderTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <Border Background="{StaticResource ItemsHeader_Background_Brush}">
                            <TextBlock Text="{Binding}" FontStyle="Italic" FontWeight="Bold" HorizontalAlignment="Left" Margin="4,4,4,4"
                                       Foreground="{StaticResource ItemsHeader_Foreground_Brush}"/>
                        </Border>

                        <Rectangle Height="3" Margin="0,0,0,-3" Opacity="0.5" VerticalAlignment="Bottom">
                            <Rectangle.Fill>
                                <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                    <GradientStop Color="#55000000" Offset="0" />
                                    <GradientStop Color="#00000000" Offset="1" />
                                </LinearGradientBrush>
                            </Rectangle.Fill>
                        </Rectangle>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="OtherItemTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock Text="{Binding}" />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="WatermarkTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock 
                               Text="{Binding}"
                               FontStyle="Italic"
                        Opacity="0.3"
                               />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:SplitComboBox">
                    <Grid>
                        <Grid.Resources>
                            <local:NullEmptyToVisibilityConverter x:Key="NullEmptyToVisibilityConverter" />
                            <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
                        </Grid.Resources>
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="ConfirmedSelectedItemStates">
                                <VisualState x:Name="ConfirmedSelectedItemCleared">
                                    <Storyboard />
                                </VisualState>
                                <VisualState x:Name="ConfirmedSelectedItemChanged">
                                    <Storyboard RepeatBehavior="2x" Duration="0:0:2">
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ConfirmedSelectedItemChangedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame Value="1" KeyTime="0:0:1" />
                                            <SplineDoubleKeyFrame Value="0" KeyTime="0:0:2" />
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal"/>
                                <VisualState x:Name="MouseOver"/>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledVisualElement" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value=".55"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                            <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused"/>
                                <VisualState x:Name="FocusedDropDown">
                                    <Storyboard>
                                        <ObjectAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="PopupBorder" Storyboard.TargetProperty="(UIElement.Visibility)">
                                            <DiscreteObjectKeyFrame KeyTime="00:00:00">
                                                <DiscreteObjectKeyFrame.Value>
                                                    <Visibility>Visible</Visibility>
                                                </DiscreteObjectKeyFrame.Value>
                                            </DiscreteObjectKeyFrame>
                                        </ObjectAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>

                        </VisualStateManager.VisualStateGroups>

                        <Border x:Name="ConfirmedSelectedItemChangedBorder" Margin="-3" IsHitTestVisible="False" Opacity="0"
                                Background="{StaticResource ItemSelected_Background_Brush}" />

                        <Border Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsLinkBorderShowing}">
                            <Border BorderThickness="1,1,1,1" BorderBrush="{TemplateBinding BorderBrush}" Margin="{TemplateBinding LinkBorderMargin}"
                                Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsOuterBorderShowing}"
                                />
                        </Border>

                        <Border BorderThickness="1" Margin="-4,-4,-4,-4"
                                Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsOuterBorderShowing}"
                                BorderBrush="{StaticResource ItemFocused_BorderBrush_Brush}"
                                Background="{StaticResource ItemFocused_Background_Brush}"
                                />


                        <Border x:Name="ContentPresenterBorder">
                            <Grid>
                                <ToggleButton x:Name="DropDownToggle" HorizontalAlignment="Stretch" Margin="0" VerticalAlignment="Stretch" 
                                              BorderThickness="{TemplateBinding BorderThickness}"
                                              BorderBrush="{TemplateBinding BorderBrush}"
                                              >
                                    <ToggleButton.Style>
                                        <Style TargetType="ToggleButton">
                                            <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
                                            <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
                                            <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
                                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                                            <Setter Property="Padding" Value="6,6,6,6" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ToggleButton">
                                                        <Grid>
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="FocusStates">
                                                                    <VisualState x:Name="Focused">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Unfocused"/>
                                                                </VisualStateGroup>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.2" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00.2" Value="0"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.X)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="ContentPresenterTranslateTransform" Storyboard.TargetProperty="(TranslateTransform.Y)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled"/>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Border BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                                                                <Grid>
                                                                    <Rectangle x:Name="MouseOverBorder" Opacity="0" Fill="{StaticResource ItemMouseOver_Background_Brush}" />
                                                                    <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="1" Opacity="0" Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />
                                                                    <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
										Margin="{TemplateBinding Padding}">
                                                                        <ContentPresenter.RenderTransform>
                                                                            <TranslateTransform x:Name="ContentPresenterTranslateTransform" />
                                                                        </ContentPresenter.RenderTransform>
                                                                    </ContentPresenter>
                                                                    <Border x:Name="PressedBorder" Opacity="0">
                                                                        <Grid>
                                                                            <Rectangle VerticalAlignment="Top" Height="3">
                                                                                <Rectangle.Fill>
                                                                                    <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                                                                        <GradientStop Color="#44000000" Offset="0"/>
                                                                                        <GradientStop Offset="1"/>
                                                                                    </LinearGradientBrush>
                                                                                </Rectangle.Fill>
                                                                            </Rectangle>
                                                                            <Rectangle HorizontalAlignment="Left" Width="3">
                                                                                <Rectangle.Fill>
                                                                                    <LinearGradientBrush EndPoint="1,0.5" StartPoint="0,0.5">
                                                                                        <GradientStop Color="#44000000" Offset="0"/>
                                                                                        <GradientStop Offset="1"/>
                                                                                    </LinearGradientBrush>
                                                                                </Rectangle.Fill>
                                                                            </Rectangle>
                                                                        </Grid>
                                                                    </Border>
                                                                </Grid>
                                                            </Border>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ToggleButton.Style>
                                </ToggleButton>
                                <Border Margin="{TemplateBinding BorderThickness}">
                                    <Grid>
                                        <ContentPresenter x:Name="SelectedItemContentPresenter" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                                          VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                          Content="{TemplateBinding ConfirmedSelectedItem}"
                                                        ContentTemplate="{TemplateBinding ItemTemplate}"
                                                           Margin="{TemplateBinding Padding}"
                                                        >
                                        </ContentPresenter>


                                        <ContentControl IsTabStop="False"
                                                        Content="{TemplateBinding Watermark}"
                                                        ContentTemplate="{TemplateBinding WatermarkTemplate}"
                                                        IsHitTestVisible="False"
                                                        Visibility="{TemplateBinding WatermarkVisibility}"
                                                        HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                                        Foreground="{TemplateBinding Foreground}"
                                                        />
                                    </Grid>
                                </Border>
                            </Grid>
                        </Border>
                        <Rectangle x:Name="DisabledVisualElement" Fill="White" RadiusX="3" RadiusY="3" IsHitTestVisible="false" Opacity="0"/>
                        <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="2" Opacity="0" IsHitTestVisible="False" Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />

                        <Popup x:Name="Popup" HorizontalAlignment="Left">
                            <Grid>
                                <Border x:Name="PopupBorder"
                                        HorizontalAlignment="Right"
                                        >
                                    <Grid>
                                        <Border
                                        BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1" Background="{TemplateBinding Background}"
                                        >
                                            <Border.Effect>
                                                <DropShadowEffect Opacity="0.5" ShadowDepth="0" BlurRadius="8" />
                                            </Border.Effect>
                                        </Border>

                                        <ScrollViewer x:Name="ScrollViewer" BorderThickness="0" Padding="0" Background="Transparent"
                                                      Margin="1"
                                                      Style="{StaticResource ScrollViewerStyle}">
                                            <ItemsPresenter/>
                                        </ScrollViewer>
                                    </Grid>

                                </Border>

                            </Grid>

                        </Popup>

                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- WatermarkedTextBox Style -->
    <Style TargetType="local:WatermarkedTextBox">
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding" Value="3"/>
        <Setter Property="WatermarkTemplate">
            <Setter.Value>
                <DataTemplate>
                    <TextBlock 
                               Text="{Binding}"
                               Opacity="0.3"
                               FontStyle="Italic"
                               />
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:WatermarkedTextBox">
                    <Grid x:Name="RootElement">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal"/>
                                <VisualState x:Name="MouseOver">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Disabled">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledVisualElement" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="ReadOnly">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="ReadOnlyVisualElement" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusVisualElement" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                                <VisualState x:Name="Unfocused">
                                    <Storyboard>
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusVisualElement" Storyboard.TargetProperty="Opacity">
                                            <SplineDoubleKeyFrame KeyTime="0" Value="0"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="ValidationStates">
                                <VisualState x:Name="Valid"/>
                                <VisualState x:Name="InvalidUnfocused" />
                                <VisualState x:Name="InvalidFocused" />
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>
                        <Border x:Name="Border" Opacity="1" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="0">
                            <Grid>
                                <Border x:Name="ReadOnlyVisualElement" Opacity="0" Background="#5EC9C9C9"/>
                                <Border x:Name="MouseOverBorder" BorderThickness="1" Opacity="0" BorderBrush="{StaticResource ItemMouseOver_BorderBrush_Brush}" />

                                <ScrollViewer x:Name="ContentElement" BorderThickness="0" IsTabStop="False" Padding="{TemplateBinding Padding}"
                                              Background="Transparent"
                                              />
                            </Grid>
                        </Border>

                        <ContentControl IsTabStop="False"
                                        Content="{TemplateBinding Watermark}"
                                        ContentTemplate="{TemplateBinding WatermarkTemplate}"
                                        Visibility="{TemplateBinding WatermarkVisibility}"
                                        Margin="{TemplateBinding Padding}"
                                        VerticalContentAlignment="Stretch"
                                        HorizontalContentAlignment="Stretch"
                                        IsHitTestVisible="False"
                                        Foreground="{TemplateBinding Foreground}"
                                        />

                        <Border x:Name="DisabledVisualElement" IsHitTestVisible="False" Opacity="0" Background="#A5F7F7F7" BorderBrush="#A5F7F7F7" BorderThickness="{TemplateBinding BorderThickness}"/>
                        <Border x:Name="FocusVisualElement" IsHitTestVisible="False" Opacity="0" BorderThickness="1" Margin="{TemplateBinding BorderThickness}" BorderBrush="{StaticResource ItemMouseOver_BorderBrush_Brush}" />
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- SearchAndPrescribe Style -->
    <Style TargetType="local:SearchAndPrescribeControl">
        <Setter Property="IsTabStop" Value="False" />
        <Setter Property="Background" Value="{StaticResource Control_Background_Brush}" />
        <Setter Property="Foreground" Value="{StaticResource Control_Foreground_Brush}" />
        <Setter Property="BorderBrush" Value="{StaticResource Control_BorderBrush_Brush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="DrugsResultsListMessage" Value="No items to display" />
        <Setter Property="DrugsResultsListMessageTemplate">
            <Setter.Value>
                <DataTemplate>
                    <Grid>
                        <StackPanel Opacity="0">
                            <TextBlock Text=" " Margin="6" />
                            <TextBlock Text=" " Margin="6" />
                            <TextBlock Text=" " Margin="6" />
                        </StackPanel>
                        <TextBlock Text="{Binding}" Margin="8"
                               FontStyle="Italic" Opacity="0.5"/>
                    </Grid>
                </DataTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="local:SearchAndPrescribeControl">
                    <Border x:Name="RootBorder" BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}"
                            Padding="{TemplateBinding Padding}"
                            >
                        <Border.Resources>
                            <local:BoolInverterConverter x:Key="BoolInverterConverter" />
                            <local:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
                            <local:NullEmptyToVisibilityConverter x:Key="NullEmptyToVisibilityConverter" />
                            <local:NullEmptyToBoolConverter x:Key="NullEmptyToBoolConverter" />
                            <local:BoolToBooleanConverter x:Key="BoolToBooleanConverter" />
                            <!-- Group Label Style -->
                            <Style TargetType="TextBlock" x:Key="GroupLabelStyle">
                                <Setter Property="Width" Value="170" />
                                <Setter Property="TextAlignment" Value="Right" />
                                <Setter Property="TextWrapping" Value="Wrap" />
                                <Setter Property="Foreground" Value="{StaticResource GroupLabel_Foreground_Brush}" />
                            </Style>

                            <!-- Group Horizontal Line Style -->
                            <Style TargetType="Path" x:Key="GroupHorizontalLineStyle">
                                <Setter Property="Stroke" Value="{StaticResource GroupLabel_Foreground_Brush}" />
                            </Style>

                            <DataTemplate x:Key="OtherItemClearTemplate">
                                <StackPanel Orientation="Horizontal">
                                    <Path Margin="0,0,5,0" VerticalAlignment="Center" Stretch="Fill" StrokeDashCap="Round" StrokeEndLineCap="Round" StrokeStartLineCap="Round" StrokeThickness="2" Height="10" Width="10" Data="M1,1 L10,8.3330002 M10.000034,1.0000015 L1.0000345,8.3330011"
                                          Stroke="{StaticResource Control_Foreground_Brush}">
                                        <Path.Effect>
                                            <BlurEffect Radius="1"/>
                                        </Path.Effect>
                                    </Path>
                                    <TextBlock Text="{Binding}" />
                                </StackPanel>
                            </DataTemplate>
                            <DataTemplate x:Key="TemplatePrescriptionPromptWatermarkTemplate">
                                <StackPanel Orientation="Horizontal" IsHitTestVisible="False">
                                    <TextBlock 
                                                               Text="{Binding}"
                                                               FontStyle="Italic"
                                                                Opacity="0.3"
                                                            Margin="0,0,5,0"
                                                            VerticalAlignment="Center"
                                                               />
                                    <Grid>
                                        <TextBlock Text="V" Opacity="0" />
                                        <Path Stretch="Fill" Data="M0,0 L5,10 L10,0 L0,0" Height="6" Width="8" VerticalAlignment="Center" HorizontalAlignment="Center"
                                              Fill="{StaticResource Control_Foreground_Brush}" />
                                    </Grid>
                                </StackPanel>
                            </DataTemplate>
                            <DataTemplate x:Key="TemplatePrescriptionNoPromptWatermarkTemplate">
                                <Grid IsHitTestVisible="False">
                                    <TextBlock Text="V" Opacity="0" />
                                    <Path Stretch="Fill" Data="M0,0 L5,10 L10,0 L0,0" Height="6" Width="8" VerticalAlignment="Center" HorizontalAlignment="Center"
                                          Fill="{StaticResource Control_Foreground_Brush}" />
                                </Grid>
                            </DataTemplate>

                            <local:ObjectCollection x:Key="DrugRouteListOptions">
                                <StackPanel Orientation="Horizontal" IsHitTestVisible="False" AutomationProperties.Name="Detailed current drug and route item">
                                    <ContentControl IsTabStop="False"  
                                                                            FontFamily="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontFamily}" 
                                                                            FontSize="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontSize}"
                                                                            Foreground="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Foreground}"
                                                                            Content="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDrug}"
                                                                        ContentTemplate="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=BasicDrugTemplate}"
                                                                        />
                                    <TextBlock Text=" - " 
                                                                       FontFamily="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontFamily}" 
                                                                            FontSize="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontSize}"
                                                                            Foreground="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Foreground}"
                                                                       />
                                    <ContentControl IsTabStop="False"  
                                                                            FontFamily="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontFamily}"  
                                                                            Foreground="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Foreground}"
                                                                            FontSize="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=FontSize}"
                                                                            Content="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=SelectedRoute}" 
                                                                        ContentTemplate="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=BasicRouteTemplate}"
                                                                            />
                                </StackPanel>
                            </local:ObjectCollection>

                            <local:ObjectCollection x:Key="AsRequiredListOptions">
                                <system:Boolean>True</system:Boolean>
                                <system:Boolean>False</system:Boolean>
                            </local:ObjectCollection>
                        </Border.Resources>

                        <Grid x:Name="RootGrid">

                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>


                            <Grid>

                                <Grid.RowDefinitions>
                                    <RowDefinition MinHeight="45" Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Rectangle Height="{TemplateBinding CascadingListMaximumHeight}" Fill="Transparent" Grid.Row="1"
                                   Visibility="{Binding ElementName=ConciseDrugsList, Converter={StaticResource NullEmptyToVisibilityConverter}, ConverterParameter=true, Path=ConfirmedSelectedItem}"
                                   />

                                <Rectangle Fill="#00000000" x:Name="BackgroundElement"
                                                       Grid.RowSpan="3"                                                       
                                                       />
                                <local:CascadingListBoxGroup  Grid.Row="1" Margin="0,0,10,0" x:Name="CascadingListBoxGroup"
                                                    >
                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseDrugsList"
                                                                     VerticalAlignment="Top"
                                local:LinkingWrapPanel.IsLinkedToNextChild="True" >
                                        <StackPanel Margin="0,0,0,15" x:Name="ConciseDrugsListContainer">
                                            <Border Height="45" Margin="15,-45,0,0" MaxWidth="350">
                                                <Border  VerticalAlignment="Bottom" MinWidth="150"                                      
                                         BorderThickness="1,1,1,0" BorderBrush="{StaticResource Control_BorderBrush_Brush}"
                                         Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ElementName=ConciseDrugsList, Path=IsExpanded}">
                                                    <Border BorderThickness="1" BorderBrush="{StaticResource Searchbox_BorderBrush_Brush}" Margin="0,0,0,0"
                                                            >
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <local:WatermarkedTextBox x:Name="DrugSearchTextBox"                                               
                                                        Watermark="Search for a drug"
                                                       BorderThickness="0"
                                                                      Text="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=DrugSearchText}"
                                                                                      SelectTextOnFocus="False"
                                                                                      Padding="4"
                                                                                      AutomationProperties.Name="Search for a drug"
                                                                      />
                                                            <Grid Grid.Column="1">
                                                                <Button Style="{StaticResource BasicButtonStyle}" Padding="3"
                                                    BorderThickness="0"
                                                    x:Name="DrugSearchButton"
                                                    IsEnabled="{TemplateBinding IsDrugSearchButtonEnabled}" Width="22"
                                                                        AutomationProperties.Name="Drug search button"/>

                                                                <Grid Height="16" Width="16" VerticalAlignment="Center" HorizontalAlignment="Center" IsHitTestVisible="False">
                                                                    <Path Stretch="Fill" StrokeEndLineCap="Round" StrokeThickness="2" Height="16" HorizontalAlignment="Right" Margin="0" VerticalAlignment="Top" Width="16" Data="M15,6 C15,8.7614241 12.761424,11 10,11 C7.2385759,11 5,8.7614241 5,6 C5,3.2385762 7.2385759,1 10,1 C12.761424,1 15,3.2385762 15,6 z M7,9 L1,15"
                                                                          Stroke="{StaticResource MagnifierGlassTop_Stroke_Brush}" />
                                                                    <Path Stretch="Fill" StrokeEndLineCap="Round" StrokeThickness="2" Height="16" HorizontalAlignment="Right" Margin="0" VerticalAlignment="Top" Width="16" Data="M15,6 C15,8.7614241 12.761424,11 10,11 C7.2385759,11 5,8.7614241 5,6 C5,3.2385762 7.2385759,1 10,1 C12.761424,1 15,3.2385762 15,6 z M7,9 L1,15" Opacity="0.7"
                                                                          Stroke="{StaticResource MagnifierGlassBottom_Stroke_Brush}" />
                                                                </Grid>
                                                            </Grid>
                                                        </Grid>
                                                    </Border>
                                                </Border>
                                            </Border>
                                            <local:CascadingListBox x:Name="ConciseDrugsList"                                                            
                                                   ItemTemplate="{TemplateBinding DrugItemTemplate}"
                                                                    SelectedItemTemplate="{TemplateBinding SelectedDrugItemTemplate}"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDrug}"
                                                   MinListBoxWidth="150"
                                                   IsExpanded="True"
                                                   CollapseOnSelection="False"
                                                   Margin="15,0,0,0"
                                                                    MaxWidth="350"
                                                                    MaxHeight="{TemplateBinding CascadingListMaximumHeight}"
                                                                    Message="{TemplateBinding DrugsResultsListMessage}"
                                                                    MessageTemplate="{TemplateBinding DrugsResultsListMessageTemplate}"
                                                                    AddShortcutKeysToPrimaryItems="True"
                                                                    PrimaryItemsSourceHeader="{TemplateBinding PrimaryDrugsItemsHeader}"
                                                                    SecondaryItemsSourceHeader="{TemplateBinding SecondaryDrugsItemsHeader}"
                                                                    AutomationProperties.Name="Drugs results"
                                               />
                                            <Border Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ElementName=ConciseDrugsList, Path=IsExpanded}">
                                                <Grid Margin="15,0,0,0" Visibility="{Binding Items, ElementName=ConciseDrugsList, Converter={StaticResource NullEmptyToVisibilityConverter}}">
                                                    <Grid Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsShowingAllDrugResults}">
                                                        <Border Padding="10,6,6,6" BorderThickness="1,0,1,1"
                                                                Background="{StaticResource Control_Background_Brush}"
                                                                BorderBrush="{StaticResource Control_BorderBrush_Brush}"
                                                                >
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="*" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <TextBlock Text="{TemplateBinding ShowAllDrugsText}" FontStyle="Italic" VerticalAlignment="Center" Margin="0,0,5,0"
                                                                           Foreground="{StaticResource Control_Foreground_Brush}" />

                                                                <Button Content="Show All" HorizontalAlignment="Right" x:Name="ShowAllDrugsButton" Style="{StaticResource BasicButtonStyle}" Grid.Column="1" Padding="4,3,4,3"/>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>

                                                </Grid>
                                            </Border>
                                        </StackPanel>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseRoutesList"
                                                                     VerticalAlignment="Top"
                                local:LinkingWrapPanel.IsLinkedToNextChild="True" >
                                        <local:CascadingListBox x:Name="ConciseRoutesList"
                                                                MaxHeight="{TemplateBinding CascadingListMaximumHeight}"
                                                   PrimaryItemsSource="{TemplateBinding ValidRoutesItemsSource}"
                                                                SecondaryItemsSource="{TemplateBinding BrandedRoutesItemsSource}"
                                                   OtherItemsSource="{TemplateBinding OtherRoutesItemsSource}"
                                                   ShowOtherOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedRoute}"
                                                   ItemTemplate="{TemplateBinding RouteItemTemplate}"
                                                                SelectedItemTemplate="{TemplateBinding SelectedRouteItemTemplate}"
                                                   Visibility="{Binding ValidRoutesItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"
                                                   IsExpanded="True"
                                                   CollapseOnSelection="False"
                                                                Margin="15,0,0,15"
                                                                AutomationProperties.Name="Routes"
                                                                MaxWidth="200"
                                               />
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseFormsList" 
                                                                     VerticalAlignment="Top">
                                        <local:CascadingListBox x:Name="ConciseFormsList"
                                                                MaxHeight="{TemplateBinding CascadingListMaximumHeight}"
                                                   PrimaryItemsSource="{TemplateBinding ConciseFormsItemsSource}"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedForm}"
                                                   ItemTemplate="{TemplateBinding FormItemTemplate}"
                                                   Visibility="{Binding IsFormMandatory, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}"
                                                   IsExpanded="True"
                                                   CollapseOnSelection="False"
                                                                Margin="15,0,0,15"
                                                                AutomationProperties.Name="Forms"
                                                                MaxWidth="200"
                                               />
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseStrengthsList"
                                                                     VerticalAlignment="Top"     
                                local:LinkingWrapPanel.IsLinkedToNextChild="True" >
                                        <local:SplitComboBox x:Name="ConciseStrengthsList"    
                                                   ItemTemplate="{TemplateBinding StrengthItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ValidStrengthsItemsSource}"
                                                   ShowOtherOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStrength}"                                     
                                                   Visibility="{Binding IsStrengthMandatory, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}"
                                                   Margin="15,0,0,15"
                                                   local:LinkingWrapPanel.IsLinkedToNextChild="True"
                                                             Watermark="Select a strength"
                                                             IsLinkBorderShowing="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidTemplatePrescriptionsItemsSource}"
                                                             IsOuterBorderShowing="{Binding ElementName=ConciseTemplatePrescriptionsList, Path=IsDropDownOpen}"
                                                             LinkBorderMargin="0,0,-8,0"
                                                             AutomationProperties.Name="Valid strengths"
                                                />
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseDosagesList"
                                                                     VerticalAlignment="Top" 
                                local:LinkingWrapPanel.IsLinkedToNextChild="True">
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding ConciseDosagesItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"  >
                                            <Rectangle Fill="Transparent" Width="15"
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}, ConverterParameter=true}"/>
                                            <Border Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}">
                                                <StackPanel Orientation="Horizontal">
                                                    <Rectangle Fill="Transparent" Width="7" />
                                                    <Rectangle Fill="Transparent" Width="8" 
                                                               Visibility="{Binding IsStrengthMandatory, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true}"/>
                                                </StackPanel>
                                            </Border>

                                            <local:SplitComboBox x:Name="ConciseDosagesList"
                                                   ItemTemplate="{TemplateBinding DoseItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ConciseDosagesItemsSource}"
                                                   ShowOtherOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDose}"                                                  
                                                             IsOuterBorderShowing="{Binding ElementName=ConciseTemplatePrescriptionsList, Path=IsDropDownOpen}"
                                                             IsLinkBorderShowing="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidTemplatePrescriptionsItemsSource}"
                                                             Watermark="Select a dose"
                                                             LinkBorderMargin="0,0,-8,0"
                                                             Margin="0,0,0,15"
                                                                 AutomationProperties.Name="Valid dosages"
                                                  />
                                        </StackPanel>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseFrequenciesList"
                                                                     VerticalAlignment="Top" 
                                local:LinkingWrapPanel.IsLinkedToNextChild="True">
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding ConciseFrequenciesItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}">
                                            <Rectangle Fill="Transparent" Width="15"
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}, ConverterParameter=true}"/>
                                            <Rectangle Fill="Transparent" Width="7" 
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"/>
                                            <local:SplitComboBox x:Name="ConciseFrequenciesList"
                                                   ItemTemplate="{TemplateBinding FrequencyItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ConciseFrequenciesItemsSource}"                                                 
                                                   ShowOtherOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedFrequency}"  
                                                             Watermark="Select a frequency"                                                        
                                                             IsOuterBorderShowing="{Binding ElementName=ConciseTemplatePrescriptionsList, Path=IsDropDownOpen}"
                                                             IsLinkBorderShowing="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidTemplatePrescriptionsItemsSource}"
                                                             LinkBorderMargin="0,0,-8,0"
                                                             Margin="0,0,0,15"
                                                                 AutomationProperties.Name="Valid frequencies"
                                                />
                                        </StackPanel>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseBrandsList"
                                                                     VerticalAlignment="Top"  
                                local:LinkingWrapPanel.IsLinkedToNextChild="True">
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding ValidBrandsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}" >
                                            <Rectangle Fill="Transparent" Width="15"
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}, ConverterParameter=true}"/>
                                            <Rectangle Fill="Transparent" Width="7" 
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"/>
                                            <local:SplitComboBox x:Name="ConciseBrandsList"
                                                   ItemTemplate="{TemplateBinding BrandItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ValidBrandsItemsSource}"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedBrand}"                                                  
                                                             IsOuterBorderShowing="{Binding ElementName=ConciseTemplatePrescriptionsList, Path=IsDropDownOpen}"
                                                             IsLinkBorderShowing="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidTemplatePrescriptionsItemsSource}"
                                                             LinkBorderMargin="0,0,-8,0"
                                                             Margin="0,0,0,15"
                                                             Watermark="Select a brand"
                                                                 AutomationProperties.Name="Valid brands"
                                                  />
                                        </StackPanel>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="ConciseTemplatePrescriptionsList"
                                                                     VerticalAlignment="Top"
                                >
                                        <StackPanel Orientation="Horizontal" Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}">
                                            <Rectangle Fill="Transparent" Width="15"
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}, ConverterParameter=true}"/>
                                            <Rectangle Fill="Transparent" Width="7" 
                                                       Visibility="{Binding ValidTemplatePrescriptionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"/>
                                            <local:SplitComboBox x:Name="ConciseTemplatePrescriptionsList"    
                                                   ItemTemplate="{TemplateBinding TemplatePrescriptionItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ValidTemplatePrescriptionsItemsSource}"
                                                   ShowOtherOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedTemplatePrescription}"                                     
                                                         IsOuterBorderShowing="{Binding ElementName=ConciseTemplatePrescriptionsList, Path=IsDropDownOpen}"
                                                             Margin="0,0,0,15"
                                                             Watermark="Select a template prescription"
                                                             WatermarkTemplate="{StaticResource TemplatePrescriptionPromptWatermarkTemplate}"
                                                                 ShowSelectedItemChangedState="False"
                                                                 AutomationProperties.Name="Template prescriptions"
                                                >
                                                <local:SplitComboBox.SelectedItemTemplate>
                                                    <DataTemplate>
                                                        <Grid IsHitTestVisible="False">
                                                            <TextBlock Text="V" Opacity="0" />
                                                            <Path Stretch="Fill" Data="M0,0 L5,10 L10,0 L0,0" Height="6" Width="8" VerticalAlignment="Center" HorizontalAlignment="Center"
                                                                  Fill="{StaticResource Control_Foreground_Brush}" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </local:SplitComboBox.SelectedItemTemplate>
                                            </local:SplitComboBox>
                                        </StackPanel>
                                    </local:CollapsibleContentControl>
                                </local:CascadingListBoxGroup>
                                <local:LinkingWrapPanel x:Name="OtherConciseElements"
                            Grid.Row="2"
                            Margin="15,0,10,0" VerticalAlignment="Center"
                            >

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                      local:CascadingListBoxGroup.CascadingListBoxName="StartingConditionItemTemplate"
                                                                     VerticalAlignment="Top"   
                               >
                                        <local:SplitComboBox x:Name="ConciseStartingConditionsList"
                                                   ItemTemplate="{TemplateBinding StartingConditionItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ValidStartingConditionsItemsSource}"
                                                   CustomValueItem="{TemplateBinding CustomStartingConditionItem}"
                                                                CustomValueItemTemplate="{TemplateBinding CustomStartingConditionItemTemplate}"
                                                                ShowCustomValueOption="True"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStartingCondition}"                                                  
                                                   Visibility="{Binding ValidStartingConditionsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"    
                                                                Watermark="Select a starting condition"
                                                              Margin="0,0,15,15"
                                                             AlwaysTopAlignDropDown="True"
                                                             AutomationProperties.Name="Starting conditions"
                                                  />
                                    </local:CollapsibleContentControl>


                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                 Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidAdministrationTimesItemsSource}">
                                        <local:LabeledContentControl
                                                     Label="{TemplateBinding AdministrationTimesLabel}"
                                                     Margin="0,0,15,15"
                                                     >
                                            <local:SplitComboBox x:Name="ConciseAdministrationTimesList" BorderThickness="0"
                                                                 ClearConfirmedSelectedItemWhenOtherSelected="False"
                                        PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidAdministrationTimesItemsSource}"
                                                ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedAdministrationTimes}"                                                 
                                                         ItemTemplate="{TemplateBinding AdministrationTimesItemTemplate}"
                                                 ShowOtherOption="True"                                                 
                                                OtherItem="edit administration details..."
                                                                 AutomationProperties.Name="Administration times"
                                  />
                                        </local:LabeledContentControl>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                     Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStartDate}">
                                        <local:LabeledContentControl Label="{TemplateBinding StartingLabel}"
                                                     Margin="0,0,15,15">
                                            <StackPanel Orientation="Horizontal">
                                                <local:DateInputBox SelectedDate="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStartDate}"
                                                                    Watermark="Enter a start date"
                                                                 BorderThickness="0" ShowSelectedDateChangedState="True"
                                                                    AutomationProperties.Name="Start date"/>

                                                <local:SplitComboBox Margin="5,0,0,0"
                                                                 BorderThickness="0"
                                                             PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidFirstDoseTimesItemsSource}"
                                                             ItemTemplate="{TemplateBinding FirstDoseTimeItemTemplate}"
                                                    ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedFirstDoseTime}"
                                                    Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidFirstDoseTimesItemsSource}"
                                                    ShowOtherOption="False" 
                                                                     AutomationProperties.Name="Start time"
                                                    />
                                            </StackPanel>
                                        </local:LabeledContentControl>
                                    </local:CollapsibleContentControl>

                                    <local:CollapsibleContentControl IsExpanded="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                     Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidDurationsItemsSource}"
                                                                     >
                                        <local:LabeledContentControl Label="{TemplateBinding ContinuingLabel}"
                                                     Margin="0,0,0,15"
                                                                     Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsOnceOnly}">
                                            <local:SplitComboBox x:Name="ConciseDurationsList"
                                            BorderThickness="0"
                                        PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidDurationsItemsSource}"
                                                ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDuration}"
                                                ShowOtherOption="True"
                                                         ItemTemplate="{TemplateBinding DurationItemTemplate}"
                                                                 Watermark="Select a duration"
                                                                 AutomationProperties.Name="Durations"
                                                />
                                        </local:LabeledContentControl>
                                    </local:CollapsibleContentControl>
                                </local:LinkingWrapPanel>

                            </Grid>

                            <Grid Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <Grid.RowDefinitions>
                                    <RowDefinition MinHeight="45" Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                             HorizontalAlignment="Left" VerticalAlignment="Top" Grid.Row="1" >
                                    <TextBlock Text="Drug"  Style="{StaticResource GroupLabelStyle}"
                                           IsHitTestVisible="False" Margin="15,7,0,8"/>
                                </local:CollapsibleContentControl>
                                <StackPanel Grid.Column="1" Grid.Row="1">


                                    <local:LinkingWrapPanel >
                                        <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                         >
                                            <local:SplitComboBox x:Name="DetailedDrugRouteList"                                                         
                                                         ShowOtherOption="True"
                                                         OtherItem="Clear and start again..."
                                                                 OtherItemTemplate="{StaticResource OtherItemClearTemplate}"
                                                                 Margin="15,0,0,15"
                                                                 ShowSelectedItemChangedState="False"
                                                                 AlwaysTopAlignDropDown="True"
                                                                 AutomationProperties.Name="Detailed current drug and route"
                                                                 PrimaryItemsSource="{StaticResource DrugRouteListOptions}"
                                                         >
                                            </local:SplitComboBox>
                                        </local:CollapsibleContentControl>

                                        <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <local:OptionalFieldContainer x:Name="DetailedBrandOptionalContainer" ShowFieldButtonContent="Select a brand"
                                                                      IsFieldShowing="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsBrandMandatory}"
                                                                      IsOptionalFieldEnabled="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidBrandsItemsSource}"
                                                                  Margin="15,0,0,15">
                                                <local:SplitComboBox x:Name="DetailedBrandsList"
                                                   ItemTemplate="{TemplateBinding BrandItemTemplate}"
                                                   PrimaryItemsSource="{TemplateBinding ValidBrandsItemsSource}"
                                                   ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedBrand}"                                                  
                                                   Visibility="{Binding ValidBrandsItemsSource, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource NullEmptyToVisibilityConverter}}"
                                                             Watermark="Select a brand"
                                                                     AutomationProperties.Name="Detailed brands"
                                                  />
                                            </local:OptionalFieldContainer>
                                        </local:CollapsibleContentControl>

                                        <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                                                        >
                                            <local:OptionalFieldContainer x:Name="DetailedReasonForPrescribingOptionalFieldContainer" ShowFieldButtonContent="Enter a reason for prescribing"
                                                                  Control="{Binding ElementName=DetailedReasonForPrescribingList}"
                                                                   Margin="15,0,0,15">
                                                <local:LabeledContentControl Label="reason for prescribing">
                                                    <local:SplitComboBox x:Name="DetailedReasonForPrescribingList"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedReasonForPrescribing}"
                                                                     Watermark="Select a reason for prescribing"
                                                                     ShowCustomValueOption="True"
                                                        OtherItem="Clear reason for prescribing"
                                                                         OtherItemTemplate="{StaticResource OtherItemClearTemplate}"
                                                        ShowOtherOption="True"
                                                                    CustomValueItem="{TemplateBinding CustomReasonForPrescribingItem}"
                                                                        CustomValueItemTemplate="{TemplateBinding CustomReasonForPrescribingItemTemplate}"
                                                                     BorderThickness="0"
                                                                         AlwaysTopAlignDropDown="True"
                                                                         AutomationProperties.Name="Detailed reasons for prescribing"
                                                         />
                                                </local:LabeledContentControl>
                                            </local:OptionalFieldContainer>
                                        </local:CollapsibleContentControl>
                                    </local:LinkingWrapPanel>

                                    <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                        <local:LabeledContentControl Label="reason for using an unlicensed route" Margin="15,0,0,15"
                                                                     Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsUnlicensed}">
                                            <local:WatermarkedTextBox x:Name="UnlicensedReasonTextBox" 
                                                       Watermark="Enter a reason for using an unlicensed route"
                                                       MinWidth="280" HorizontalAlignment="Left"
                                                       Padding="6,6,6,6"
                                                                  TextWrapping="Wrap" MaxWidth="280" MaxLength="128"
                                                       Text="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=UnlicensedReason}"
                                                       BorderThickness="0"
                                                                      AutomationProperties.Name="Detailed reason for using an unlicensed route"
                                                                      />
                                        </local:LabeledContentControl>
                                    </local:CollapsibleContentControl>
                                </StackPanel>

                            </Grid>

                            <ScrollViewer x:Name="ScrollViewer" Grid.Row="2" IsTabStop="False"
                                          BorderThickness="0" Padding="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="{TemplateBinding DetailedViewMaxHeight}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <Grid Margin="15,15,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>



                                        <local:CollapsibleContentControl Grid.Row="0" HorizontalAlignment="Right"  Grid.RowSpan="1"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <TextBlock Text="Strength, form and device"  Margin="0,6,0,0" Style="{StaticResource GroupLabelStyle}" />
                                        </local:CollapsibleContentControl>
                                        <local:LinkingWrapPanel Grid.Column="1" Grid.Row="0">
                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:OptionalFieldContainer x:Name="DetailedStrengthsOptionalFieldContainer" Margin="15,0,0,15" ShowFieldButtonContent="Add a strength" IsFieldShowing="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsStrengthMandatory}"
                                                                          IsOptionalFieldEnabled="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidStrengthsItemsSource}">
                                                    <local:SplitComboBox x:Name="DetailedStrengthsList" PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidStrengthsItemsSource}"
                                                                     SecondaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=OtherStrengthsItemsSource}"
                                                         ItemTemplate="{TemplateBinding StrengthItemTemplate}"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStrength}"                                     
                                                                     Watermark="Select a strength"
                                                                     PrimaryItemsSourceHeader="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidStrengthsItemsHeader}"
                                                                     SecondaryItemsSourceHeader="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=OtherStrengthsItemsHeader}"
                                                                     OtherItem="Clear strength"
                                                                         OtherItemTemplate="{StaticResource OtherItemClearTemplate}"
                                                                     ShowOtherOption="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsStrengthMandatory}"
                                                                         AutomationProperties.Name="Detailed strengths"
                                                         />
                                                </local:OptionalFieldContainer>
                                            </local:CollapsibleContentControl>
                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:OptionalFieldContainer x:Name="DetailedFormsOptionalFieldContainer" Margin="15,0,0,15"  ShowFieldButtonContent="Add a form" IsFieldShowing="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsFormMandatory}"
                                                                          IsOptionalFieldEnabled="{Binding  Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidFormsItemsSource}">
                                                    <local:SplitComboBox x:Name="DetailedFormsList" PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidFormsItemsSource}"
                                                                 SecondaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=OtherFormsItemsSource}"
                                                         ItemTemplate="{TemplateBinding FormItemTemplate}"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedForm}"                                     
                                                                 Watermark="Select a form"
                                                                 PrimaryItemsSourceHeader="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidFormsItemsHeader}"
                                                                     SecondaryItemsSourceHeader="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=OtherFormsItemsHeader}"
                                                                 OtherItem="Clear form"
                                                                         OtherItemTemplate="{StaticResource OtherItemClearTemplate}"
                                                                     ShowOtherOption="{Binding Converter={StaticResource BoolInverterConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsFormMandatory}"
                                                                         AutomationProperties.Name="Detailed forms"
                                                         />
                                                </local:OptionalFieldContainer>
                                            </local:CollapsibleContentControl>
                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:OptionalFieldContainer Margin="15,0,0,15"  ShowFieldButtonContent="Add a device">
                                                </local:OptionalFieldContainer>
                                            </local:CollapsibleContentControl>
                                        </local:LinkingWrapPanel>

                                        <local:CollapsibleContentControl Grid.Row="1" Grid.ColumnSpan="2"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <Path Stretch="Uniform" Style="{StaticResource GroupHorizontalLineStyle}" Height="1" Margin="0,0,0,15" Data="M0,0 L5000,0" StrokeDashArray="2 2" />
                                        </local:CollapsibleContentControl>

                                        <local:CollapsibleContentControl Grid.Row="2" Grid.RowSpan="2" HorizontalAlignment="Right"   IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <Grid>
                                                <TextBlock Text="Dose, site and frequency"  Margin="0,6,0,0" Style="{StaticResource GroupLabelStyle}"
                                                   Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsUnlicensed}"/>
                                                <TextBlock Text="Method, site and frequency"  Margin="0,6,0,0" Style="{StaticResource GroupLabelStyle}" 
                                                   Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsUnlicensed}"/>
                                            </Grid>
                                        </local:CollapsibleContentControl>

                                        <StackPanel Grid.Column="1" Grid.Row="2">
                                            <local:LinkingWrapPanel>
                                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                    <local:SplitComboBox x:Name="DetailedDosagesList" PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=DetailedDosagesItemsSource}"
                                                         ItemTemplate="{TemplateBinding DoseItemTemplate}"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDose}"
                                                         Margin="15,0,0,15"
                                                                     Watermark="Select a dose"
                                                                     ShowCustomValueOption="True"
                                                        CustomValueItem="{TemplateBinding CustomDoseItem}"
                                                                CustomValueItemTemplate="{TemplateBinding CustomDoseItemTemplate}"                                                                     
                                                                     Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsUnlicensed}"
                                                                         AutomationProperties.Name="Detailed dosages"
                                                         />
                                                </local:CollapsibleContentControl>

                                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                    <local:LabeledContentControl Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsUnlicensed}"
                                                                             Margin="15,0,0,15" Label="METHOD">
                                                        <local:LabeledContentControl.LabelTemplate>
                                                            <DataTemplate>
                                                                <Border>
                                                                    <Border.Resources>
                                                                        <SolidColorBrush x:Key="FieldLabel_Foreground_Brush" Color="#ff508dc2"  />
                                                                        <SolidColorBrush x:Key="HC_FieldLabel_Foreground_Brush" Color="#FF00FFF0"  />

                                                                        <Style TargetType="TextBlock" x:Key="MethodLabelStyle">
                                                                            <Setter Property="Foreground" Value="{StaticResource FieldLabel_Foreground_Brush}" />
                                                                            <Setter Property="VerticalAlignment" Value="Center" />
                                                                            <Setter Property="FontFamily" Value="Courier New" />
                                                                            <Setter Property="Margin" Value="0,0,2,0" />
                                                                            <Setter Property="RenderTransform">
                                                                                <Setter.Value>
                                                                                    <TransformGroup>
                                                                                        <ScaleTransform ScaleX="1.1" ScaleY="1.1" />
                                                                                        <TranslateTransform Y="0" />
                                                                                    </TransformGroup>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                    </Border.Resources>
                                                                    <TextBlock Style="{StaticResource MethodLabelStyle}" Text="{Binding}" />
                                                                </Border>
                                                            </DataTemplate>
                                                        </local:LabeledContentControl.LabelTemplate>
                                                        <local:WatermarkedTextBox x:Name="DetailedMethodTextBox" Watermark="Enter a method of administration"
                                                                       MinWidth="150" Padding="6,6,6,6"
                                                                       BorderThickness="0"
                                                                                  TextWrapping="Wrap" MaxWidth="350" MaxLength="128"
                                                                       Text="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedMethod}"
                                                                                  AutomationProperties.Name="Detailed method"/>
                                                    </local:LabeledContentControl>
                                                </local:CollapsibleContentControl>

                                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                    <local:OptionalFieldContainer x:Name="DetailedSiteOptionalFieldContainer" ShowFieldButtonContent="Add a site"
                                                                                      IsFieldShowing="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsSiteMandatory}"
                                                                  Margin="15,0,0,15" VerticalContentAlignment="Center"
                                                                  >
                                                        <local:SplitComboBox x:Name="DetailedSitesList"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedSite}"
                                                                     Watermark="Select a site"
                                                                     ShowCustomValueOption="True"
                                                        OtherItem="Clear site"
                                                                             OtherItemTemplate="{StaticResource OtherItemClearTemplate}"
                                                        ShowOtherOption="True"
                                                                    CustomValueItem="{TemplateBinding CustomSiteItem}"
                                                                        CustomValueItemTemplate="{TemplateBinding CustomSiteItemTemplate}"
                                                                             AlwaysTopAlignDropDown="True"
                                                                             AutomationProperties.Name="Detailed sites"
                                                         />
                                                    </local:OptionalFieldContainer>
                                                </local:CollapsibleContentControl>
                                            </local:LinkingWrapPanel>

                                            <local:LinkingWrapPanel>
                                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                    <local:SplitComboBox x:Name="DetailedFrequenciesList" PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=DetailedFrequenciesItemsSource}"
                                                                     CustomValueItem="{TemplateBinding CustomFrequencyItem}"
                                                CustomValueItemTemplate="{TemplateBinding CustomFrequencyItemTemplate}"
                                                                     ShowCustomValueOption="True"
                                                         ItemTemplate="{TemplateBinding FrequencyItemTemplate}"
                                                         ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedFrequency}"
                                                         Margin="15,0,0,15"
                                                                     Watermark="Select a frequency"
                                                                         AutomationProperties.Name="Detailed frequencies"
                                                         />
                                                </local:CollapsibleContentControl>

                                                <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                    <local:OptionalFieldContainer x:Name="DetailedAsRequiredOptionFieldContainer" ShowFieldButtonContent="As required" IsFieldShowing="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=IsAsRequired}"
                                                                  Margin="15,0,0,15" Control="{Binding ElementName=DetailedStartingConditionsList}"
                                                                  Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsOnceOnly}">
                                                        <StackPanel Orientation="Horizontal">
                                                            <local:SplitComboBox ConfirmedSelectedItem="{Binding Mode=TwoWay, Converter={StaticResource BoolToBooleanConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsAsRequired}"
                                                                             Margin="0,0,0,0" VerticalAlignment="Top"
                                                                                 AutomationProperties.Name="Detailed as required"
                                                                                 PrimaryItemsSource="{StaticResource AsRequiredListOptions}">
                                                                <local:SplitComboBox.ItemTemplate>
                                                                    <DataTemplate>
                                                                        <Grid IsHitTestVisible="False">
                                                                            <TextBlock Text="as required" Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}}" />
                                                                            <StackPanel Orientation="Horizontal" Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true}" >
                                                                                <Path Margin="0,0,5,0" VerticalAlignment="Center" Stretch="Fill" StrokeDashCap="Round" StrokeEndLineCap="Round" StrokeStartLineCap="Round" StrokeThickness="2" Height="10" Width="10" Data="M1,1 L10,8.3330002 M10.000034,1.0000015 L1.0000345,8.3330011"
                                                                                      Stroke="{StaticResource Control_Foreground_Brush}">
                                                                                    <Path.Effect>
                                                                                        <BlurEffect Radius="1"/>
                                                                                    </Path.Effect>
                                                                                </Path>
                                                                                <TextBlock Text="Clear as required" />
                                                                            </StackPanel>
                                                                        </Grid>
                                                                    </DataTemplate>
                                                                </local:SplitComboBox.ItemTemplate>
                                                            </local:SplitComboBox>
                                                            <local:SplitComboBox x:Name="DetailedStartingConditionsList" ItemTemplate="{TemplateBinding StartingConditionItemTemplate}"
                                                                             PrimaryItemsSource="{TemplateBinding ValidStartingConditionsItemsSource}"
                                                                             CustomValueItem="{TemplateBinding CustomStartingConditionItem}"
                                                                             CustomValueItemTemplate="{TemplateBinding CustomStartingConditionItemTemplate}"
                                                                             ShowCustomValueOption="True"
                                                                             ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStartingCondition}"                                                  
                                                                             Margin="15,0,0,0"
                                                                             Watermark="Select a starting condition"
                                                                                 AlwaysTopAlignDropDown="True"
                                                                                 AutomationProperties.Name="Detailed starting conditions"
                                                  />
                                                        </StackPanel>
                                                    </local:OptionalFieldContainer>
                                                </local:CollapsibleContentControl>
                                            </local:LinkingWrapPanel>
                                        </StackPanel>


                                        <local:CollapsibleContentControl Grid.Row="3" Grid.ColumnSpan="2"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <Path Stretch="Uniform" Style="{StaticResource GroupHorizontalLineStyle}" Height="1" Margin="0,0,0,15" Data="M0,0 L5000,0" StrokeDashArray="2 2" />
                                        </local:CollapsibleContentControl>

                                        <local:CollapsibleContentControl Grid.Row="4" Grid.RowSpan="2" HorizontalAlignment="Right"   IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <TextBlock Text="Administration" Margin="0,6,0,0" Style="{StaticResource GroupLabelStyle}" />
                                        </local:CollapsibleContentControl>

                                        <StackPanel Grid.Column="1" Grid.Row="4">
                                            <local:CollapsibleContentControl Grid.Row="4" Grid.RowSpan="2"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:LabeledContentControl Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidAdministrationTimesItemsSource}"
                                                     Label="{TemplateBinding AdministrationTimesLabel}"
                                                     Margin="15,0,0,15"
                                                     >
                                                    <local:SplitComboBox x:Name="DetailedAdministrationTimesList" BorderThickness="0"
                                                                         ClearConfirmedSelectedItemWhenOtherSelected="False"
                                        PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidAdministrationTimesItemsSource}"
                                                ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedAdministrationTimes}"                                                 
                                                         ItemTemplate="{TemplateBinding AdministrationTimesItemTemplate}"
                                                 ShowOtherOption="True"                                                 
                                                OtherItem="edit administration details..."
                                                                         AutomationProperties.Name="Detailed administration times"
                                  />
                                                </local:LabeledContentControl>
                                            </local:CollapsibleContentControl>

                                            <local:CollapsibleContentControl Grid.Row="4" Grid.RowSpan="2"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:LinkingWrapPanel>
                                                    <local:LabeledContentControl Label="{TemplateBinding StartingLabel}"
                                                     Margin="15,0,0,15">
                                                        <StackPanel Orientation="Horizontal">
                                                            <local:DateInputBox SelectedDate="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedStartDate}"
                                                                                Watermark="Enter a start date"
                                                                         BorderThickness="0" ShowSelectedDateChangedState="True"
                                                                                AutomationProperties.Name="Detailed start date"/>

                                                            <local:SplitComboBox Margin="5,0,0,0"
                                                                         BorderThickness="0"
                                                             PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidFirstDoseTimesItemsSource}"
                                                             ItemTemplate="{TemplateBinding FirstDoseTimeItemTemplate}"
                                                    ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedFirstDoseTime}"
                                                    Visibility="{Binding Converter={StaticResource NullEmptyToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=ValidFirstDoseTimesItemsSource}"
                                                    ShowOtherOption="False"         
                                                                                 AutomationProperties.Name="Detailed start time"
                                                    />
                                                        </StackPanel>
                                                    </local:LabeledContentControl>
                                                    <local:OptionalFieldContainer ShowFieldButtonContent="For Self Administration"
                                                                  Margin="15,0,0,15"
                                                                  />
                                                </local:LinkingWrapPanel>
                                            </local:CollapsibleContentControl>
                                        </StackPanel>


                                        <local:CollapsibleContentControl Grid.Row="5" Grid.ColumnSpan="2"  IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <Path Stretch="Uniform" Style="{StaticResource GroupHorizontalLineStyle}" Height="1" Margin="0,0,0,15" Data="M0,0 L5000,0" StrokeDashArray="2 2" />
                                        </local:CollapsibleContentControl>

                                        <local:CollapsibleContentControl Grid.Row="6" Grid.RowSpan="1" HorizontalAlignment="Right"   IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                            <TextBlock Text="Duration"  Margin="0,6,0,0" Style="{StaticResource GroupLabelStyle}" 
                                                   Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsOnceOnly}"/>
                                        </local:CollapsibleContentControl>

                                        <local:LinkingWrapPanel Grid.Column="1" Grid.Row="6">
                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:SplitComboBox x:Name="DetailedDurationsList" 
                                                                     Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsOnceOnly}"
                                        Margin="15,0,0,15"
                                        PrimaryItemsSource="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=ValidDurationsItemsSource}"
                                                CustomValueItem="{TemplateBinding CustomDurationItem}"
                                                CustomValueItemTemplate="{TemplateBinding CustomDurationItemTemplate}"
                                                ConfirmedSelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDuration}"
                                                ShowOtherOption="False"
                                                ShowCustomValueOption="True"                                                
                                                         ItemTemplate="{TemplateBinding DurationItemTemplate}"
                                                Watermark="Select a duration"
                                                                     AutomationProperties.Name="Detailed durations"
                                                />
                                            </local:CollapsibleContentControl>

                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:OptionalFieldContainer ShowFieldButtonContent="Add a start condition"
                                                                  Margin="15,0,0,15"
                                                                  />
                                            </local:CollapsibleContentControl>

                                            <local:CollapsibleContentControl IsExpanded="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                                <local:OptionalFieldContainer ShowFieldButtonContent="Add a review date"
                                                                  Margin="15,0,0,15"
                                                                  />
                                            </local:CollapsibleContentControl>
                                        </local:LinkingWrapPanel>

                                    </Grid>


                                    <Border Padding="4" Grid.Row="1" BorderThickness="0,1,0,0" BorderBrush="{TemplateBinding BorderBrush}"
                                            Background="{StaticResource Toolbar_Background_Brush}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <CheckBox x:Name="ConciseDetailedViewToggleButton" IsChecked="{Binding Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}"
                                              IsEnabled="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsConciseDetailedViewToggleEnabled}"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"
                                                      Style="{StaticResource ToolbarButton_ViewToggle_Style}"
                                                      AutomationProperties.Name="Show more detail"
                                              
                                  >
                                                <Grid>
                                                    <TextBlock Text="More Detail" Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=true, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}" />
                                                    <TextBlock Text="Less Detail" Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}" />
                                                </Grid>
                                            </CheckBox>

                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <Button IsEnabled="{Binding Converter={StaticResource NullEmptyToBoolConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=SelectedDrug}"
                                                        Margin="0,0,4,0"
                                                        Content="Preview"
                                                        x:Name="PreviewButton"
                                                         Style="{StaticResource ToolbarButton_Style}"
                                                        />
                                                <Button IsEnabled="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsAuthorizable}"
                                                        Content="Authorise"
                                                        x:Name="AuthorizeButton"
                                                         Style="{StaticResource ToolbarButton_Style}"
                                                        />
                                            </StackPanel>

                                            <Border Grid.ColumnSpan="2" Margin="-4" IsHitTestVisible="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=IsAuthorizable}">
                                                <Rectangle Fill="#00000000" IsHitTestVisible="{Binding ElementName=ConciseDrugsList, Path=IsExpanded}" 
                                                       
                                                       />
                                            </Border>

                                        </Grid>



                                    </Border>

                                </Grid>

                            </ScrollViewer>

                            <Grid VerticalAlignment="Top" HorizontalAlignment="Right" Grid.RowSpan="3">
                                <Button x:Name="CloseButton" Width="31" Height="20" AutomationProperties.Name="Close button"
                                        BorderBrush="{StaticResource Control_BorderBrush_Brush}"
                                        >
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Grid>
                                                            <VisualStateManager.VisualStateGroups>
                                                                <VisualStateGroup x:Name="FocusStates">
                                                                    <VisualState x:Name="Focused">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="FocusBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Unfocused"/>
                                                                </VisualStateGroup>
                                                                <VisualStateGroup x:Name="CommonStates">
                                                                    <VisualState x:Name="Normal">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00.2000000" Value="0"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="MouseOver">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00.2000000" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Pressed">
                                                                        <Storyboard>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="PressedBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="grid" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.X)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="grid" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Duration="00:00:00.0010000" Storyboard.TargetName="MouseOverBorder" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                                                <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                                                            </DoubleAnimationUsingKeyFrames>
                                                                        </Storyboard>
                                                                    </VisualState>
                                                                    <VisualState x:Name="Disabled"/>
                                                                </VisualStateGroup>
                                                            </VisualStateManager.VisualStateGroups>
                                                            <Border x:Name="MouseOverBorder" BorderThickness="1,0,0,1" CornerRadius="0,0,0,2" BorderBrush="{TemplateBinding BorderBrush}" Opacity="0">
                                                                <Border.Effect>
                                                                    <DropShadowEffect Color="#FFB03001" ShadowDepth="0" Direction="260"/>
                                                                </Border.Effect>
                                                                <Border.Background>
                                                                    <LinearGradientBrush EndPoint="0.5,0" StartPoint="0.5,1">
                                                                        <GradientStop Color="#FFAF2F00" Offset="0"/>
                                                                        <GradientStop Color="#FFFFC4B1" Offset="1"/>
                                                                        <GradientStop Color="#FFEC5F2B" Offset="0.5"/>
                                                                        <GradientStop Color="#FFE55A26" Offset="0.5"/>
                                                                    </LinearGradientBrush>
                                                                </Border.Background>
                                                            </Border>


                                                            <Border x:Name="PressedBorder" BorderThickness="1" CornerRadius="0,0,2,2" BorderBrush="{TemplateBinding BorderBrush}" Opacity="0">
                                                                <Border.Background>
                                                                    <LinearGradientBrush EndPoint="0.5,0" StartPoint="0.5,1">
                                                                        <GradientStop Color="#FFA73206" Offset="0"/>
                                                                        <GradientStop Color="#FF862100" Offset="1"/>
                                                                        <GradientStop Color="#FFB94317" Offset="0.523"/>
                                                                    </LinearGradientBrush>
                                                                </Border.Background>
                                                            </Border>


                                                            <Grid x:Name="grid" Height="10" HorizontalAlignment="Center" Margin="1" VerticalAlignment="Center" Width="10" RenderTransformOrigin="0.5,0.5">
                                                                <Grid.RenderTransform>
                                                                    <TransformGroup>
                                                                        <ScaleTransform/>
                                                                        <SkewTransform/>
                                                                        <RotateTransform/>
                                                                        <TranslateTransform/>
                                                                    </TransformGroup>
                                                                </Grid.RenderTransform>
                                                                <Path Stretch="Fill" Stroke="#FF5F5F5F" StrokeDashCap="Square" StrokeEndLineCap="Square" StrokeStartLineCap="Square" StrokeThickness="4" Height="10" Margin="0" Width="10" Data="M1,1 L10,8.3330002 M10.000034,1.0000015 L1.0000345,8.3330011" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                <Path Stretch="Fill" Stroke="White" StrokeDashCap="Square" StrokeEndLineCap="Square" StrokeStartLineCap="Square" StrokeThickness="2" Height="8" Margin="0" Width="8" Data="M1,1 L10,8.3330002 M10.000034,1.0000015 L1.0000345,8.3330011" />
                                                            </Grid>

                                                            <Rectangle x:Name="FocusBorder" StrokeDashArray="2 2" Margin="2" Opacity="0" Stroke="{StaticResource Control_FocusBorderBrush_Brush}" />

                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>

                                    </Button.Style>
                                </Button>
                            </Grid>

                            <Rectangle Grid.Row="2" Height="5" VerticalAlignment="Top" IsHitTestVisible="False"
                                       Visibility="{Binding Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource TemplatedParent}, Path=IsDetailedView}">
                                <Rectangle.Fill>
                                    <LinearGradientBrush StartPoint="0.5,0" EndPoint="0.5,1">
                                        <GradientStop Color="#44000000" Offset="0" />
                                        <GradientStop Color="#00000000" Offset="1" />
                                    </LinearGradientBrush>
                                </Rectangle.Fill>
                            </Rectangle>

                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
